var THREE=THREE||{};window.Int32Array||(window.Int32Array=Array,window.Float32Array=Array),THREE.Color=function(e){this.setHex(e)},THREE.Color.prototype={autoUpdate:!0,copy:function(e){this.r=e.r,this.g=e.g,this.b=e.b,this.hex=e.hex,this.__styleString=e.__styleString},setRGB:function(e,t,i){this.r=e,this.g=t,this.b=i,this.autoUpdate&&(this.updateHex(),this.updateStyleString())},setHSV:function(e,t,i){var r,n,o,a,s,h;if(0==i)r=n=o=0;else switch(a=Math.floor(6*e),s=6*e-a,e=i*(1-t),h=i*(1-t*s),t=i*(1-t*(1-s)),a){case 1:r=h,n=i,o=e;break;case 2:r=e,n=i,o=t;break;case 3:r=e,n=h,o=i;break;case 4:r=t,n=e,o=i;break;case 5:r=i,n=e,o=h;break;case 6:case 0:r=i,n=t,o=e}this.r=r,this.g=n,this.b=o,this.autoUpdate&&(this.updateHex(),this.updateStyleString())},setHex:function(e){this.hex=16777215&~~e,this.autoUpdate&&(this.updateRGB(),this.updateStyleString())},updateHex:function(){this.hex=~~(255*this.r)<<16^~~(255*this.g)<<8^~~(255*this.b)},updateRGB:function(){this.r=(this.hex>>16&255)/255,this.g=(this.hex>>8&255)/255,this.b=(255&this.hex)/255},updateStyleString:function(){this.__styleString="rgb("+~~(255*this.r)+","+~~(255*this.g)+","+~~(255*this.b)+")"},clone:function(){return new THREE.Color(this.hex)}},THREE.Vector2=function(e,t){this.set(e||0,t||0)},THREE.Vector2.prototype={set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.set(e.x,e.y),this},addSelf:function(e){return this.set(this.x+e.x,this.y+e.y),this},add:function(e,t){return this.set(e.x+t.x,e.y+t.y),this},subSelf:function(e){return this.set(this.x-e.x,this.y-e.y),this},sub:function(e,t){return this.set(e.x-t.x,e.y-t.y),this},multiplyScalar:function(e){return this.set(this.x*e,this.y*e),this},negate:function(){return this.set(-this.x,-this.y),this},unit:function(){return this.multiplyScalar(1/this.length()),this},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(e,t,i){this.set(e||0,t||0,i||0)},THREE.Vector3.prototype={set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},copy:function(e){return this.set(e.x,e.y,e.z),this},add:function(e,t){return this.set(e.x+t.x,e.y+t.y,e.z+t.z),this},addSelf:function(e){return this.set(this.x+e.x,this.y+e.y,this.z+e.z),this},addScalar:function(e){return this.set(this.x+e,this.y+e,this.z+e),this},sub:function(e,t){return this.set(e.x-t.x,e.y-t.y,e.z-t.z),this},subSelf:function(e){return this.set(this.x-e.x,this.y-e.y,this.z-e.z),this},cross:function(e,t){return this.set(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x),this},crossSelf:function(e){var t=this.x,i=this.y,r=this.z;return this.set(i*e.z-r*e.y,r*e.x-t*e.z,t*e.y-i*e.x),this},multiply:function(e,t){return this.set(e.x*t.x,e.y*t.y,e.z*t.z),this},multiplySelf:function(e){return this.set(this.x*e.x,this.y*e.y,this.z*e.z),this},multiplyScalar:function(e){return this.set(this.x*e,this.y*e,this.z*e),this},divideSelf:function(e){return this.set(this.x/e.x,this.y/e.y,this.z/e.z),this},divideScalar:function(e){return this.set(this.x/e,this.y/e,this.z/e),this},negate:function(){return this.set(-this.x,-this.y,-this.z),this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return e=this.z-e.z,t*t+i*i+e*e},length:function(){return Math.sqrt(this.lengthSq())},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){var e=this.length();return e>0?this.multiplyScalar(1/e):this.set(0,0,0),this},setPositionFromMatrix:function(e){this.x=e.n14,this.y=e.n24,this.z=e.n34},setRotationFromMatrix:function(e){this.y=Math.asin(e.n13);var t=Math.cos(this.y);Math.abs(t)>1e-5?(this.x=Math.atan2(-e.n23/t,e.n33/t),this.z=Math.atan2(-e.n13/t,e.n11/t)):(this.x=0,this.z=Math.atan2(e.n21,e.n22))},setLength:function(e){return this.normalize().multiplyScalar(e)},isZero:function(){return Math.abs(this.x)<1e-4&&Math.abs(this.y)<1e-4&&Math.abs(this.z)<1e-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.Vector4=function(e,t,i,r){this.set(e||0,t||0,i||0,r||1)},THREE.Vector4.prototype={set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},copy:function(e){return this.set(e.x,e.y,e.z,e.w||1),this},add:function(e,t){return this.set(e.x+t.x,e.y+t.y,e.z+t.z,e.w+t.w),this},addSelf:function(e){return this.set(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w),this},sub:function(e,t){return this.set(e.x-t.x,e.y-t.y,e.z-t.z,e.w-t.w),this},subSelf:function(e){return this.set(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w),this},multiplyScalar:function(e){return this.set(this.x*e,this.y*e,this.z*e,this.w*e),this},divideScalar:function(e){return this.set(this.x/e,this.y/e,this.z/e,this.w/e),this},lerpSelf:function(e,t){this.set(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t,this.z+(e.z-this.z)*t,this.w+(e.w-this.w)*t)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Ray=function(e,t){this.origin=e||new THREE.Vector3,this.direction=t||new THREE.Vector3},THREE.Ray.prototype={intersectScene:function(e){var t,i,r=e.objects,n=[];for(e=0,t=r.length;e<t;e++)i=r[e],i instanceof THREE.Mesh&&(n=n.concat(this.intersectObject(i)));return n.sort(function(e,t){return e.distance-t.distance}),n},intersectObject:function(e){function t(e,t,i,r){r=r.clone().subSelf(t),i=i.clone().subSelf(t);var n=e.clone().subSelf(t);e=r.dot(r),t=r.dot(i),r=r.dot(n);var o=i.dot(i);return i=i.dot(n),n=1/(e*o-t*t),o=(o*r-t*i)*n,e=(e*i-t*r)*n,o>0&&e>0&&o+e<1}var i,r,n,o,a,s,h,l,c,f,E,u=e.geometry,d=u.vertices,p=[];for(i=0,r=u.faces.length;i<r;i++)n=u.faces[i],f=this.origin.clone(),E=this.direction.clone(),h=e.matrixWorld,o=h.multiplyVector3(d[n.a].position.clone()),a=h.multiplyVector3(d[n.b].position.clone()),s=h.multiplyVector3(d[n.c].position.clone()),h=n instanceof THREE.Face4?h.multiplyVector3(d[n.d].position.clone()):null,l=e.matrixRotationWorld.multiplyVector3(n.normal.clone()),c=E.dot(l),(e.doubleSided||(e.flipSided?c>0:c<0))&&(l=l.dot((new THREE.Vector3).sub(o,f))/c,f=f.addSelf(E.multiplyScalar(l)),n instanceof THREE.Face3?t(f,o,a,s)&&(n={distance:this.origin.distanceTo(f),point:f,face:n,object:e},p.push(n)):n instanceof THREE.Face4&&(t(f,o,a,h)||t(f,a,s,h))&&(n={distance:this.origin.distanceTo(f),point:f,face:n,object:e},p.push(n)));return p}},THREE.Rectangle=function(){function e(){o=r-t,a=n-i}var t,i,r,n,o,a,s=!0;this.getX=function(){return t},this.getY=function(){return i},this.getWidth=function(){return o},this.getHeight=function(){return a},this.getLeft=function(){return t},this.getTop=function(){return i},this.getRight=function(){return r},this.getBottom=function(){return n},this.set=function(o,a,h,l){s=!1,t=o,i=a,r=h,n=l,e()},this.addPoint=function(o,a){s?(s=!1,t=o,i=a,r=o,n=a):(t=t<o?t:o,i=i<a?i:a,r=r>o?r:o,n=n>a?n:a),e()},this.add3Points=function(o,a,h,l,c,f){s?(s=!1,t=o<h?o<c?o:c:h<c?h:c,i=a<l?a<f?a:f:l<f?l:f,r=o>h?o>c?o:c:h>c?h:c,n=a>l?a>f?a:f:l>f?l:f):(t=o<h?o<c?o<t?o:t:c<t?c:t:h<c?h<t?h:t:c<t?c:t,i=a<l?a<f?a<i?a:i:f<i?f:i:l<f?l<i?l:i:f<i?f:i,r=o>h?o>c?o>r?o:r:c>r?c:r:h>c?h>r?h:r:c>r?c:r,n=a>l?a>f?a>n?a:n:f>n?f:n:l>f?l>n?l:n:f>n?f:n),e()},this.addRectangle=function(o){s?(s=!1,t=o.getLeft(),i=o.getTop(),r=o.getRight(),n=o.getBottom()):(t=t<o.getLeft()?t:o.getLeft(),i=i<o.getTop()?i:o.getTop(),r=r>o.getRight()?r:o.getRight(),n=n>o.getBottom()?n:o.getBottom()),e()},this.inflate=function(o){t-=o,i-=o,r+=o,n+=o,e()},this.minSelf=function(o){t=t>o.getLeft()?t:o.getLeft(),i=i>o.getTop()?i:o.getTop(),r=r<o.getRight()?r:o.getRight(),n=n<o.getBottom()?n:o.getBottom(),e()},this.instersects=function(e){return Math.min(r,e.getRight())-Math.max(t,e.getLeft())>=0&&Math.min(n,e.getBottom())-Math.max(i,e.getTop())>=0},this.empty=function(){s=!0,n=r=i=t=0,e()},this.isEmpty=function(){return s}},THREE.Matrix3=function(){this.m=[]},THREE.Matrix3.prototype={transpose:function(){var e,t=this.m;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},transposeIntoArray:function(e){var t=this.m;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},THREE.Matrix4=function(e,t,i,r,n,o,a,s,h,l,c,f,E,u,d,p){this.set(e||1,t||0,i||0,r||0,n||0,o||1,a||0,s||0,h||0,l||0,c||1,f||0,E||0,u||0,d||0,p||1),this.flat=Array(16),this.m33=new THREE.Matrix3},THREE.Matrix4.prototype={set:function(e,t,i,r,n,o,a,s,h,l,c,f,E,u,d,p){return this.n11=e,this.n12=t,this.n13=i,this.n14=r,this.n21=n,this.n22=o,this.n23=a,this.n24=s,this.n31=h,this.n32=l,this.n33=c,this.n34=f,this.n41=E,this.n42=u,this.n43=d,this.n44=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.set(e.n11,e.n12,e.n13,e.n14,e.n21,e.n22,e.n23,e.n24,e.n31,e.n32,e.n33,e.n34,e.n41,e.n42,e.n43,e.n44),this},lookAt:function(e,t,i){var r=THREE.Matrix4.__v1,n=THREE.Matrix4.__v2,o=THREE.Matrix4.__v3;return o.sub(e,t).normalize(),0===o.length()&&(o.z=1),r.cross(i,o).normalize(),0===r.length()&&(o.x+=1e-4,r.cross(i,o).normalize()),n.cross(o,r).normalize(),this.n11=r.x,this.n12=n.x,this.n13=o.x,this.n21=r.y,this.n22=n.y,this.n23=o.y,this.n31=r.z,this.n32=n.z,this.n33=o.z,this},multiplyVector3:function(e){var t=e.x,i=e.y,r=e.z,n=1/(this.n41*t+this.n42*i+this.n43*r+this.n44);return e.x=(this.n11*t+this.n12*i+this.n13*r+this.n14)*n,e.y=(this.n21*t+this.n22*i+this.n23*r+this.n24)*n,e.z=(this.n31*t+this.n32*i+this.n33*r+this.n34)*n,e},multiplyVector4:function(e){var t=e.x,i=e.y,r=e.z,n=e.w;return e.x=this.n11*t+this.n12*i+this.n13*r+this.n14*n,e.y=this.n21*t+this.n22*i+this.n23*r+this.n24*n,e.z=this.n31*t+this.n32*i+this.n33*r+this.n34*n,e.w=this.n41*t+this.n42*i+this.n43*r+this.n44*n,e},rotateAxis:function(e){var t=e.x,i=e.y,r=e.z;return e.x=t*this.n11+i*this.n12+r*this.n13,e.y=t*this.n21+i*this.n22+r*this.n23,e.z=t*this.n31+i*this.n32+r*this.n33,e.normalize(),e},crossVector:function(e){var t=new THREE.Vector4;return t.x=this.n11*e.x+this.n12*e.y+this.n13*e.z+this.n14*e.w,t.y=this.n21*e.x+this.n22*e.y+this.n23*e.z+this.n24*e.w,t.z=this.n31*e.x+this.n32*e.y+this.n33*e.z+this.n34*e.w,t.w=e.w?this.n41*e.x+this.n42*e.y+this.n43*e.z+this.n44*e.w:1,t},multiply:function(e,t){var i=e.n11,r=e.n12,n=e.n13,o=e.n14,a=e.n21,s=e.n22,h=e.n23,l=e.n24,c=e.n31,f=e.n32,E=e.n33,u=e.n34,d=e.n41,p=e.n42,m=e.n43,g=e.n44,T=t.n11,v=t.n12,R=t.n13,_=t.n14,y=t.n21,x=t.n22,b=t.n23,H=t.n24,S=t.n31,M=t.n32,A=t.n33,w=t.n34;return this.n11=i*T+r*y+n*S,this.n12=i*v+r*x+n*M,this.n13=i*R+r*b+n*A,this.n14=i*_+r*H+n*w+o,this.n21=a*T+s*y+h*S,this.n22=a*v+s*x+h*M,this.n23=a*R+s*b+h*A,this.n24=a*_+s*H+h*w+l,this.n31=c*T+f*y+E*S,this.n32=c*v+f*x+E*M,this.n33=c*R+f*b+E*A,this.n34=c*_+f*H+E*w+u,this.n41=d*T+p*y+m*S,this.n42=d*v+p*x+m*M,this.n43=d*R+p*b+m*A,this.n44=d*_+p*H+m*w+g,this},multiplyToArray:function(e,t,i){return this.multiply(e,t),i[0]=this.n11,i[1]=this.n21,i[2]=this.n31,i[3]=this.n41,i[4]=this.n12,i[5]=this.n22,i[6]=this.n32,i[7]=this.n42,i[8]=this.n13,i[9]=this.n23,i[10]=this.n33,i[11]=this.n43,i[12]=this.n14,i[13]=this.n24,i[14]=this.n34,i[15]=this.n44,this},multiplySelf:function(e){return this.multiply(this,e),this},multiplyScalar:function(e){return this.n11*=e,this.n12*=e,this.n13*=e,this.n14*=e,this.n21*=e,this.n22*=e,this.n23*=e,this.n24*=e,this.n31*=e,this.n32*=e,this.n33*=e,this.n34*=e,this.n41*=e,this.n42*=e,this.n43*=e,this.n44*=e,this},determinant:function(){var e=this.n11,t=this.n12,i=this.n13,r=this.n14,n=this.n21,o=this.n22,a=this.n23,s=this.n24,h=this.n31,l=this.n32,c=this.n33,f=this.n34,E=this.n41,u=this.n42,d=this.n43,p=this.n44;return r*a*l*E-i*s*l*E-r*o*c*E+t*s*c*E+i*o*f*E-t*a*f*E-r*a*h*u+i*s*h*u+r*n*c*u-e*s*c*u-i*n*f*u+e*a*f*u+r*o*h*d-t*s*h*d-r*n*l*d+e*s*l*d+t*n*f*d-e*o*f*d-i*o*h*p+t*a*h*p+i*n*l*p-e*a*l*p-t*n*c*p+e*o*c*p},transpose:function(){var e;return e=this.n21,this.n21=this.n12,this.n12=e,e=this.n31,this.n31=this.n13,this.n13=e,e=this.n32,this.n32=this.n23,this.n23=e,e=this.n41,this.n41=this.n14,this.n14=e,e=this.n42,this.n42=this.n24,this.n24=e,e=this.n43,this.n43=this.n34,this.n43=e,this},clone:function(){var e=new THREE.Matrix4;return e.n11=this.n11,e.n12=this.n12,e.n13=this.n13,e.n14=this.n14,e.n21=this.n21,e.n22=this.n22,e.n23=this.n23,e.n24=this.n24,e.n31=this.n31,e.n32=this.n32,e.n33=this.n33,e.n34=this.n34,e.n41=this.n41,e.n42=this.n42,e.n43=this.n43,e.n44=this.n44,e},flatten:function(){return this.flat[0]=this.n11,this.flat[1]=this.n21,this.flat[2]=this.n31,this.flat[3]=this.n41,this.flat[4]=this.n12,this.flat[5]=this.n22,this.flat[6]=this.n32,this.flat[7]=this.n42,this.flat[8]=this.n13,this.flat[9]=this.n23,this.flat[10]=this.n33,this.flat[11]=this.n43,this.flat[12]=this.n14,this.flat[13]=this.n24,this.flat[14]=this.n34,this.flat[15]=this.n44,this.flat},flattenToArray:function(e){return e[0]=this.n11,e[1]=this.n21,e[2]=this.n31,e[3]=this.n41,e[4]=this.n12,e[5]=this.n22,e[6]=this.n32,e[7]=this.n42,e[8]=this.n13,e[9]=this.n23,e[10]=this.n33,e[11]=this.n43,e[12]=this.n14,e[13]=this.n24,e[14]=this.n34,e[15]=this.n44,e},flattenToArrayOffset:function(e,t){return e[t]=this.n11,e[t+1]=this.n21,e[t+2]=this.n31,e[t+3]=this.n41,e[t+4]=this.n12,e[t+5]=this.n22,e[t+6]=this.n32,e[t+7]=this.n42,e[t+8]=this.n13,e[t+9]=this.n23,e[t+10]=this.n33,e[t+11]=this.n43,e[t+12]=this.n14,e[t+13]=this.n24,e[t+14]=this.n34,e[t+15]=this.n44,e},setTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},setScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},setRotationX:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},setRotationY:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},setRotationZ:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},setRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,a=e.y,s=e.z,h=n*o,l=n*a;return this.set(h*o+i,h*a-r*s,h*s+r*a,0,h*a+r*s,l*a+i,l*s-r*o,0,h*s-r*a,l*s+r*o,n*s*s+i,0,0,0,0,1),this},setPosition:function(e){return this.n14=e.x,this.n24=e.y,this.n34=e.z,this},setRotationFromEuler:function(e){var t=e.x,i=e.y,r=e.z;e=Math.cos(t),t=Math.sin(t);var n=Math.cos(i);i=Math.sin(i);var o=Math.cos(r);r=Math.sin(r);var a=e*i,s=t*i;return this.n11=n*o,this.n12=-n*r,this.n13=i,this.n21=s*o+e*r,this.n22=-s*r+e*o,this.n23=-t*n,this.n31=-a*o+t*r,this.n32=a*r+t*o,this.n33=e*n,this},setRotationFromQuaternion:function(e){var t=e.x,i=e.y,r=e.z,n=e.w,o=t+t,a=i+i,s=r+r;e=t*o;var h=t*a;t*=s;var l=i*a;return i*=s,r*=s,o*=n,a*=n,n*=s,this.n11=1-(l+r),this.n12=h-n,this.n13=t+a,this.n21=h+n,this.n22=1-(e+r),this.n23=i-o,this.n31=t-a,this.n32=i+o,this.n33=1-(e+l),this},scale:function(e){var t=e.x,i=e.y;return e=e.z,this.n11*=t,this.n12*=i,this.n13*=e,this.n21*=t,this.n22*=i,this.n23*=e,this.n31*=t,this.n32*=i,this.n33*=e,this.n41*=t,this.n42*=i,this.n43*=e,this},extractPosition:function(e){this.n14=e.n14,this.n24=e.n24,this.n34=e.n34},extractRotation:function(e,t){var i=1/t.x,r=1/t.y,n=1/t.z;this.n11=e.n11*i,this.n21=e.n21*i,this.n31=e.n31*i,this.n12=e.n12*r,this.n22=e.n22*r,this.n32=e.n32*r,this.n13=e.n13*n,this.n23=e.n23*n,this.n33=e.n33*n}},THREE.Matrix4.makeInvert=function(e,t){var i=e.n11,r=e.n12,n=e.n13,o=e.n14,a=e.n21,s=e.n22,h=e.n23,l=e.n24,c=e.n31,f=e.n32,E=e.n33,u=e.n34,d=e.n41,p=e.n42,m=e.n43,g=e.n44;return void 0===t&&(t=new THREE.Matrix4),t.n11=h*u*p-l*E*p+l*f*m-s*u*m-h*f*g+s*E*g,t.n12=o*E*p-n*u*p-o*f*m+r*u*m+n*f*g-r*E*g,t.n13=n*l*p-o*h*p+o*s*m-r*l*m-n*s*g+r*h*g,t.n14=o*h*f-n*l*f-o*s*E+r*l*E+n*s*u-r*h*u,t.n21=l*E*d-h*u*d-l*c*m+a*u*m+h*c*g-a*E*g,t.n22=n*u*d-o*E*d+o*c*m-i*u*m-n*c*g+i*E*g,t.n23=o*h*d-n*l*d-o*a*m+i*l*m+n*a*g-i*h*g,t.n24=n*l*c-o*h*c+o*a*E-i*l*E-n*a*u+i*h*u,t.n31=s*u*d-l*f*d+l*c*p-a*u*p-s*c*g+a*f*g,t.n32=o*f*d-r*u*d-o*c*p+i*u*p+r*c*g-i*f*g,t.n33=n*l*d-o*s*d+o*a*p-i*l*p-r*a*g+i*s*g,t.n34=o*s*c-r*l*c-o*a*f+i*l*f+r*a*u-i*s*u,t.n41=h*f*d-s*E*d-h*c*p+a*E*p+s*c*m-a*f*m,t.n42=r*E*d-n*f*d+n*c*p-i*E*p-r*c*m+i*f*m,t.n43=n*s*d-r*h*d-n*a*p+i*h*p+r*a*m-i*s*m,t.n44=r*h*c-n*s*c+n*a*f-i*h*f-r*a*E+i*s*E,t.multiplyScalar(1/e.determinant()),t},THREE.Matrix4.makeInvert3x3=function(e){var t=e.m33,i=t.m,r=e.n33*e.n22-e.n32*e.n23,n=-e.n33*e.n21+e.n31*e.n23,o=e.n32*e.n21-e.n31*e.n22,a=-e.n33*e.n12+e.n32*e.n13,s=e.n33*e.n11-e.n31*e.n13,h=-e.n32*e.n11+e.n31*e.n12,l=e.n23*e.n12-e.n22*e.n13,c=-e.n23*e.n11+e.n21*e.n13,f=e.n22*e.n11-e.n21*e.n12;if(e=e.n11*r+e.n21*a+e.n31*l,0==e)throw"matrix not invertible";return e=1/e,i[0]=e*r,i[1]=e*n,i[2]=e*o,i[3]=e*a,i[4]=e*s,i[5]=e*h,i[6]=e*l,i[7]=e*c,i[8]=e*f,t},THREE.Matrix4.makeFrustum=function(e,t,i,r,n,o){var a;return a=new THREE.Matrix4,a.n11=2*n/(t-e),a.n12=0,a.n13=(t+e)/(t-e),a.n14=0,a.n21=0,a.n22=2*n/(r-i),a.n23=(r+i)/(r-i),a.n24=0,a.n31=0,a.n32=0,a.n33=-(o+n)/(o-n),a.n34=-2*o*n/(o-n),a.n41=0,a.n42=0,a.n43=-1,a.n44=0,a},THREE.Matrix4.makePerspective=function(e,t,i,r){var n;return e=i*Math.tan(e*Math.PI/360),n=-e,THREE.Matrix4.makeFrustum(n*t,e*t,n,e,i,r)},THREE.Matrix4.makeOrtho=function(e,t,i,r,n,o){var a,s,h,l;return a=new THREE.Matrix4,s=t-e,h=i-r,l=o-n,a.n11=2/s,a.n12=0,a.n13=0,a.n14=-(t+e)/s,a.n21=0,a.n22=2/h,a.n23=0,a.n24=-(i+r)/h,a.n31=0,a.n32=0,a.n33=-2/l,a.n34=-(o+n)/l,a.n41=0,a.n42=0,a.n43=0,a.n44=1,a},THREE.Matrix4.__v1=new THREE.Vector3,THREE.Matrix4.__v2=new THREE.Vector3,THREE.Matrix4.__v3=new THREE.Vector3,THREE.Object3D=function(){this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.scale=new THREE.Vector3(1,1,1),this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixRotationWorld=new THREE.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.quaternion=new THREE.Quaternion,this.useQuaternion=!1,this.boundRadius=0,this.boundRadiusScale=1,this.visible=!0,this._vector=new THREE.Vector3},THREE.Object3D.prototype={translate:function(e,t){this.matrix.rotateAxis(t),this.position.addSelf(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},lookAt:function(e){this.matrix.lookAt(this.position,e,this.up),this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(e){if(-1===this.children.indexOf(e)){void 0!==e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e);for(var t=this;t instanceof THREE.Scene==!1&&void 0!==t;)t=t.parent;void 0!==t&&t.addChildRecurse(e)}},removeChild:function(e){var t=this.children.indexOf(e);-1!==t&&(e.parent=void 0,this.children.splice(t,1))},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||(this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))),this.matrixWorldNeedsUpdate=!0},update:function(e,t,i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale),this.matrixWorldNeedsUpdate=!1,t=!0),e=0;for(var r=this.children.length;e<r;e++)this.children[e].update(this.matrixWorld,t,i)}},THREE.Quaternion=function(e,t,i,r){this.set(e||0,t||0,i||0,void 0!==r?r:1)},THREE.Quaternion.prototype={set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setFromEuler:function(e){var t=.5*Math.PI/360,i=e.x*t,r=e.y*t,n=e.z*t;e=Math.cos(r),r=Math.sin(r),t=Math.cos(-n),n=Math.sin(-n);var o=Math.cos(i);i=Math.sin(i);var a=e*t,s=r*n;return this.w=a*o-s*i,this.x=a*i+s*o,this.y=r*t*o+e*n*i,this.z=e*n*o-r*t*i,this},calculateW:function(){return this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z)),this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0==e?this.w=this.z=this.y=this.x=0:(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},multiplySelf:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.x,a=e.y,s=e.z;return e=e.w,this.x=t*e+n*o+i*s-r*a,this.y=i*e+n*a+r*o-t*s,this.z=r*e+n*s+t*a-i*o,this.w=n*e-t*o-i*a-r*s,this},multiplyVector3:function(e,t){t||(t=e);var i=e.x,r=e.y,n=e.z,o=this.x,a=this.y,s=this.z,h=this.w,l=h*i+a*n-s*r,c=h*r+s*i-o*n,f=h*n+o*r-a*i;return i=-o*i-a*r-s*n,t.x=l*h+i*-o+c*-s-f*-a,t.y=c*h+i*-a+f*-o-l*-s,t.z=f*h+i*-s+l*-a-c*-o,t}},THREE.Quaternion.slerp=function(e,t,i,r){var n=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(Math.abs(n)>=1)return i.w=e.w,i.x=e.x,i.y=e.y,i.z=e.z,i;var o=Math.acos(n),a=Math.sqrt(1-n*n);return Math.abs(a)<.001?(i.w=.5*(e.w+t.w),i.x=.5*(e.x+t.x),i.y=.5*(e.y+t.y),i.z=.5*(e.z+t.z),i):(n=Math.sin((1-r)*o)/a,r=Math.sin(r*o)/a,i.w=e.w*n+t.w*r,i.x=e.x*n+t.x*r,i.y=e.y*n+t.y*r,i.z=e.z*n+t.z*r,i)},THREE.Vertex=function(e){this.position=e||new THREE.Vector3},THREE.Face3=function(e,t,i,r,n,o){this.a=e,this.b=t,this.c=i,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=n instanceof THREE.Color?n:new THREE.Color,this.vertexColors=n instanceof Array?n:[],this.vertexTangents=[],this.materials=o instanceof Array?o:[o],this.centroid=new THREE.Vector3},THREE.Face4=function(e,t,i,r,n,o,a){this.a=e,this.b=t,this.c=i,this.d=r,this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=o instanceof THREE.Color?o:new THREE.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materials=a instanceof Array?a:[a],this.centroid=new THREE.Vector3},THREE.UV=function(e,t){this.set(e||0,t||0)},THREE.UV.prototype={set:function(e,t){return this.u=e,this.v=t,this},copy:function(e){return this.set(e.u,e.v),this}},THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++,this.vertices=[],this.colors=[],this.faces=[],this.edges=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1},THREE.Geometry.prototype={computeCentroids:function(){var e,t,i;for(e=0,t=this.faces.length;e<t;e++)i=this.faces[e],i.centroid.set(0,0,0),i instanceof THREE.Face3?(i.centroid.addSelf(this.vertices[i.a].position),i.centroid.addSelf(this.vertices[i.b].position),i.centroid.addSelf(this.vertices[i.c].position),i.centroid.divideScalar(3)):i instanceof THREE.Face4&&(i.centroid.addSelf(this.vertices[i.a].position),i.centroid.addSelf(this.vertices[i.b].position),i.centroid.addSelf(this.vertices[i.c].position),i.centroid.addSelf(this.vertices[i.d].position),i.centroid.divideScalar(4))},computeFaceNormals:function(e){var t,i,r,n,o,a,s=new THREE.Vector3,h=new THREE.Vector3;for(r=0,n=this.faces.length;r<n;r++){if(o=this.faces[r],e&&o.vertexNormals.length){for(s.set(0,0,0),t=0,i=o.vertexNormals.length;t<i;t++)s.addSelf(o.vertexNormals[t]);s.divideScalar(3)}else t=this.vertices[o.a],i=this.vertices[o.b],a=this.vertices[o.c],s.sub(a.position,i.position),h.sub(t.position,i.position),s.crossSelf(h);s.isZero()||s.normalize(),o.normal.copy(s)}},computeVertexNormals:function(){var e,t,i,r;if(null==this.__tmpVertices){for(r=this.__tmpVertices=Array(this.vertices.length),e=0,t=this.vertices.length;e<t;e++)r[e]=new THREE.Vector3;for(e=0,t=this.faces.length;e<t;e++)i=this.faces[e],i instanceof THREE.Face3?i.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]:i instanceof THREE.Face4&&(i.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3])}else for(r=this.__tmpVertices,e=0,t=this.vertices.length;e<t;e++)r[e].set(0,0,0);for(e=0,t=this.faces.length;e<t;e++)i=this.faces[e],i instanceof THREE.Face3?(r[i.a].addSelf(i.normal),r[i.b].addSelf(i.normal),r[i.c].addSelf(i.normal)):i instanceof THREE.Face4&&(r[i.a].addSelf(i.normal),r[i.b].addSelf(i.normal),r[i.c].addSelf(i.normal),r[i.d].addSelf(i.normal));for(e=0,t=this.vertices.length;e<t;e++)r[e].normalize();for(e=0,t=this.faces.length;e<t;e++)i=this.faces[e],i instanceof THREE.Face3?(i.vertexNormals[0].copy(r[i.a]),i.vertexNormals[1].copy(r[i.b]),i.vertexNormals[2].copy(r[i.c])):i instanceof THREE.Face4&&(i.vertexNormals[0].copy(r[i.a]),i.vertexNormals[1].copy(r[i.b]),i.vertexNormals[2].copy(r[i.c]),i.vertexNormals[3].copy(r[i.d]))},computeTangents:function(){function e(e,t,i,r,n,o,b){s=e.vertices[t].position,h=e.vertices[i].position,l=e.vertices[r].position,c=a[n],f=a[o],E=a[b],u=h.x-s.x,d=l.x-s.x,p=h.y-s.y,m=l.y-s.y,g=h.z-s.z,T=l.z-s.z,v=f.u-c.u,R=E.u-c.u,_=f.v-c.v,y=E.v-c.v,x=1/(v*y-R*_),M.set((y*u-_*d)*x,(y*p-_*m)*x,(y*g-_*T)*x),A.set((v*d-R*u)*x,(v*m-R*p)*x,(v*T-R*g)*x),H[t].addSelf(M),H[i].addSelf(M),H[r].addSelf(M),S[t].addSelf(A),S[i].addSelf(A),S[r].addSelf(A)}var t,i,r,n,o,a,s,h,l,c,f,E,u,d,p,m,g,T,v,R,_,y,x,b,H=[],S=[],M=new THREE.Vector3,A=new THREE.Vector3,w=new THREE.Vector3,F=new THREE.Vector3,L=new THREE.Vector3;for(t=0,i=this.vertices.length;t<i;t++)H[t]=new THREE.Vector3,S[t]=new THREE.Vector3;for(t=0,i=this.faces.length;t<i;t++)o=this.faces[t],a=this.faceVertexUvs[0][t],o instanceof THREE.Face3?e(this,o.a,o.b,o.c,0,1,2):o instanceof THREE.Face4&&(e(this,o.a,o.b,o.c,0,1,2),e(this,o.a,o.b,o.d,0,1,3));var C=["a","b","c","d"];for(t=0,i=this.faces.length;t<i;t++)for(o=this.faces[t],r=0;r<o.vertexNormals.length;r++)L.copy(o.vertexNormals[r]),n=o[C[r]],b=H[n],w.copy(b),w.subSelf(L.multiplyScalar(L.dot(b))).normalize(),F.cross(o.vertexNormals[r],b),n=F.dot(S[n]),n=n<0?-1:1,o.vertexTangents[r]=new THREE.Vector4(w.x,w.y,w.z,n);this.hasTangents=!0},computeBoundingBox:function(){var e;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var t=1,i=this.vertices.length;t<i;t++)e=this.vertices[t],e.position.x<this.boundingBox.x[0]?this.boundingBox.x[0]=e.position.x:e.position.x>this.boundingBox.x[1]&&(this.boundingBox.x[1]=e.position.x),e.position.y<this.boundingBox.y[0]?this.boundingBox.y[0]=e.position.y:e.position.y>this.boundingBox.y[1]&&(this.boundingBox.y[1]=e.position.y),e.position.z<this.boundingBox.z[0]?this.boundingBox.z[0]=e.position.z:e.position.z>this.boundingBox.z[1]&&(this.boundingBox.z[1]=e.position.z)}},computeBoundingSphere:function(){for(var e=null===this.boundingSphere?0:this.boundingSphere.radius,t=0,i=this.vertices.length;t<i;t++)e=Math.max(e,this.vertices[t].position.length());this.boundingSphere={radius:e}},computeEdgeFaces:function(){function e(e,t){return Math.min(e,t)+"_"+Math.max(e,t)}function t(e,t,i){void 0===e[t]?(e[t]={set:{},array:[]},e[t].set[i]=1,e[t].array.push(i)):void 0===e[t].set[i]&&(e[t].set[i]=1,e[t].array.push(i))}var i,r,n,o,a,s={};for(i=0,r=this.faces.length;i<r;i++)a=this.faces[i],a instanceof THREE.Face3?(n=e(a.a,a.b),t(s,n,i),n=e(a.b,a.c),t(s,n,i),n=e(a.a,a.c),t(s,n,i)):a instanceof THREE.Face4&&(n=e(a.b,a.d),t(s,n,i),n=e(a.a,a.b),t(s,n,i),n=e(a.a,a.d),t(s,n,i),n=e(a.b,a.c),t(s,n,i),n=e(a.c,a.d),t(s,n,i));for(i=0,r=this.edges.length;i<r;i++)for(a=this.edges[i],n=a.vertexIndices[0],o=a.vertexIndices[1],a.faceIndices=s[e(n,o)].array,n=0;n<a.faceIndices.length;n++)o=a.faceIndices[n],a.faces.push(this.faces[o])}},THREE.GeometryIdCounter=0,THREE.Camera=function(e,t,i,r,n){THREE.Object3D.call(this),this.fov=e||50,this.aspect=t||1,this.near=i||.1,this.far=r||2e3,this.target=n||new THREE.Object3D,this.useTarget=!0,this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=null,this.updateProjectionMatrix()},THREE.Camera.prototype=new THREE.Object3D,THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.supr=THREE.Object3D.prototype,THREE.Camera.prototype.translate=function(e,t){this.matrix.rotateAxis(t),this.position.addSelf(t.multiplyScalar(e)),this.target.position.addSelf(t.multiplyScalar(e))},THREE.Camera.prototype.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.Camera.prototype.updateMatrix=function(){this.update(void 0,!0)},THREE.Camera.prototype.update=function(e,t,i){for(this.useTarget?(this.matrix.lookAt(this.position,this.target.position,this.up),this.matrix.setPosition(this.position),e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse),t=!0):(t||this.matrixWorldNeedsUpdate)&&(e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0,THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)),e=0;e<this.children.length;e++)this.children[e].update(this.matrixWorld,t,i)},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=new THREE.Object3D,THREE.Light.prototype.constructor=THREE.Light,THREE.Light.prototype.supr=THREE.Object3D.prototype,THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(e,t,i){THREE.Light.call(this,e),this.position=new THREE.Vector3(0,1,0),this.intensity=t||1,this.distance=i||0},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(e,t,i){THREE.Light.call(this,e),this.position=new THREE.Vector3,this.intensity=t||1,this.distance=i||0},THREE.PointLight.prototype=new THREE.Light,THREE.PointLight.prototype.constructor=THREE.PointLight,THREE.LensFlare=function(e,t,i,r){THREE.Object3D.call(this),this.positionScreen=new THREE.Vector3,this.lensFlares=[],this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,r)},THREE.LensFlare.prototype=new THREE.Object3D,THREE.LensFlare.prototype.constructor=THREE.LensFlare,THREE.LensFlare.prototype.supr=THREE.Object3D.prototype,THREE.LensFlare.prototype.add=function(e,t,i,r){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===r&&(r=THREE.BillboardBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:1,blending:r})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,r=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;e<i;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},THREE.Material=function(e){this.id=THREE.MaterialCounter.value++,e=e||{},this.opacity=void 0!==e.opacity?e.opacity:1,this.transparent=void 0!==e.transparent&&e.transparent,this.blending=void 0!==e.blending?e.blending:THREE.NormalBlending,this.depthTest=void 0===e.depthTest||e.depthTest},THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NormalBlending=0,THREE.AdditiveBlending=1,THREE.SubtractiveBlending=2,THREE.MultiplyBlending=3,THREE.AdditiveAlphaBlending=4,THREE.MaterialCounter={value:0},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.LatitudeReflectionMapping=function(){},THREE.LatitudeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.UVMapping=function(){},THREE.LineBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),
this.linewidth=void 0!==e.linewidth?e.linewidth:1,this.linecap=void 0!==e.linecap?e.linecap:"round",this.linejoin=void 0!==e.linejoin?e.linejoin:"round",this.vertexColors=!!e.vertexColors&&e.vertexColors},THREE.LineBasicMaterial.prototype=new THREE.Material,THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.MeshBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshBasicMaterial.prototype=new THREE.Material,THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshLambertMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshLambertMaterial.prototype=new THREE.Material,THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshPhongMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.ambient=void 0!==e.ambient?new THREE.Color(e.ambient):new THREE.Color(328965),this.specular=void 0!==e.specular?new THREE.Color(e.specular):new THREE.Color(1118481),this.shininess=void 0!==e.shininess?e.shininess:30,this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshPhongMaterial.prototype=new THREE.Material,THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshDepthMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1},THREE.MeshDepthMaterial.prototype=new THREE.Material,THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.shading=e.shading?e.shading:THREE.FlatShading,this.wireframe=!!e.wireframe&&e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth?e.wireframeLinewidth:1},THREE.MeshNormalMaterial.prototype=new THREE.Material,THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshFaceMaterial=function(){},THREE.MeshShaderMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.fragmentShader=void 0!==e.fragmentShader?e.fragmentShader:"void main() {}",this.vertexShader=void 0!==e.vertexShader?e.vertexShader:"void main() {}",this.uniforms=void 0!==e.uniforms?e.uniforms:{},this.attributes=e.attributes,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.fog=void 0!==e.fog&&e.fog,this.lights=void 0!==e.lights&&e.lights,this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.MeshShaderMaterial.prototype=new THREE.Material,THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial,THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:null,this.size=void 0!==e.size?e.size:1,this.sizeAttenuation=void 0===e.sizeAttenuation||e.sizeAttenuation,this.vertexColors=void 0!==e.vertexColors&&e.vertexColors},THREE.ParticleBasicMaterial.prototype=new THREE.Material,THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial,THREE.ShadowVolumeDynamicMaterial=function(e){THREE.Material.call(this,e),e=e||{},this.color=void 0!==e.color?new THREE.Color(e.color):new THREE.Color(16777215),this.map=void 0!==e.map?e.map:null,this.lightMap=void 0!==e.lightMap?e.lightMap:null,this.envMap=void 0!==e.envMap?e.envMap:null,this.combine=void 0!==e.combine?e.combine:THREE.MultiplyOperation,this.reflectivity=void 0!==e.reflectivity?e.reflectivity:1,this.refractionRatio=void 0!==e.refractionRatio?e.refractionRatio:.98,this.shading=void 0!==e.shading?e.shading:THREE.SmoothShading,this.wireframe=void 0!==e.wireframe&&e.wireframe,this.wireframeLinewidth=void 0!==e.wireframeLinewidth?e.wireframeLinewidth:1,this.wireframeLinecap=void 0!==e.wireframeLinecap?e.wireframeLinecap:"round",this.wireframeLinejoin=void 0!==e.wireframeLinejoin?e.wireframeLinejoin:"round",this.vertexColors=void 0!==e.vertexColors&&e.vertexColors,this.skinning=void 0!==e.skinning&&e.skinning,this.morphTargets=void 0!==e.morphTargets&&e.morphTargets},THREE.ShadowVolumeDynamicMaterial.prototype=new THREE.Material,THREE.ShadowVolumeDynamicMaterial.prototype.constructor=THREE.ShadowVolumeDynamicMaterial,THREE.Texture=function(e,t,i,r,n,o){this.image=e,this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrapS=void 0!==i?i:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==n?n:THREE.LinearFilter,this.minFilter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.needsUpdate=!1},THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter)}},THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.RepeatWrapping=0,THREE.ClampToEdgeWrapping=1,THREE.MirroredRepeatWrapping=2,THREE.NearestFilter=3,THREE.NearestMipMapNearestFilter=4,THREE.NearestMipMapLinearFilter=5,THREE.LinearFilter=6,THREE.LinearMipMapNearestFilter=7,THREE.LinearMipMapLinearFilter=8,THREE.ByteType=9,THREE.UnsignedByteType=10,THREE.ShortType=11,THREE.UnsignedShortType=12,THREE.IntType=13,THREE.UnsignedIntType=14,THREE.FloatType=15,THREE.AlphaFormat=16,THREE.RGBFormat=17,THREE.RGBAFormat=18,THREE.LuminanceFormat=19,THREE.LuminanceAlphaFormat=20,THREE.Particle=function(e){THREE.Object3D.call(this),this.materials=e instanceof Array?e:[e],this.matrixAutoUpdate=!1},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.materials=t instanceof Array?t:[t],this.sortParticles=!1},THREE.ParticleSystem.prototype=new THREE.Object3D,THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem,THREE.Line=function(e,t,i){THREE.Object3D.call(this),this.geometry=e,this.materials=t instanceof Array?t:[t],this.type=null!=i?i:THREE.LineStrip},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(e,t){if(THREE.Object3D.call(this),this.geometry=e,this.materials=t&&t.length?t:[t],this.flipSided=!1,this.doubleSided=!1,this.overdraw=!1,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=e.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0;i<this.geometry.morphTargets.length;i++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[i].name]=i}},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.supr=THREE.Object3D.prototype,THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4,this.hasNoneBoneChildren=!1},THREE.Bone.prototype=new THREE.Object3D,THREE.Bone.prototype.constructor=THREE.Bone,THREE.Bone.prototype.supr=THREE.Object3D.prototype,THREE.Bone.prototype.update=function(e,t,i){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiply(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var r,n=this.children.length;if(this.hasNoneBoneChildren)for(this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix),r=0;r<n;r++)e=this.children[r],e instanceof THREE.Bone?e.update(this.skinMatrix,t,i):e.update(this.matrixWorld,!0,i);else for(r=0;r<n;r++)this.children[r].update(this.skinMatrix,t,i)},THREE.Bone.prototype.addChild=function(e){-1===this.children.indexOf(e)&&(void 0!==e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e),e instanceof THREE.Bone||(this.hasNoneBoneChildren=!0))},THREE.SkinnedMesh=function(e,t){var i,r,n,o,a,s;if(THREE.Mesh.call(this,e,t),this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[],void 0!==this.geometry.bones){for(i=0;i<this.geometry.bones.length;i++)n=this.geometry.bones[i],o=n.pos,a=n.rotq,s=n.scl,r=this.addBone(),r.name=n.name,r.position.set(o[0],o[1],o[2]),r.quaternion.set(a[0],a[1],a[2],a[3]),r.useQuaternion=!0,void 0!==s?r.scale.set(s[0],s[1],s[2]):r.scale.set(1,1,1);for(i=0;i<this.bones.length;i++)n=this.geometry.bones[i],r=this.bones[i],-1===n.parent?this.addChild(r):this.bones[n.parent].addChild(r);this.boneMatrices=new Float32Array(16*this.bones.length),this.pose()}},THREE.SkinnedMesh.prototype=new THREE.Mesh,THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh,THREE.SkinnedMesh.prototype.update=function(e,t,i){if(this.visible){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var r,n=this.children.length;for(r=0;r<n;r++)e=this.children[r],e instanceof THREE.Bone?e.update(this.identityMatrix,!1,i):e.update(this.matrixWorld,t,i);for(i=this.bones.length,ba=this.bones,bm=this.boneMatrices,t=0;t<i;t++)ba[t].skinMatrix.flattenToArrayOffset(bm,16*t)}},THREE.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.pose=function(){this.update(void 0,!0);for(var e,t=[],i=0;i<this.bones.length;i++)e=this.bones[i],t.push(THREE.Matrix4.makeInvert(e.skinMatrix)),e.skinMatrix.flattenToArrayOffset(this.boneMatrices,16*i);var r;if(void 0===this.geometry.skinVerticesA)for(this.geometry.skinVerticesA=[],this.geometry.skinVerticesB=[],e=0;e<this.geometry.skinIndices.length;e++){i=this.geometry.vertices[e].position;var n=this.geometry.skinIndices[e].x,o=this.geometry.skinIndices[e].y;r=new THREE.Vector3(i.x,i.y,i.z),this.geometry.skinVerticesA.push(t[n].multiplyVector3(r)),r=new THREE.Vector3(i.x,i.y,i.z),this.geometry.skinVerticesB.push(t[o].multiplyVector3(r)),this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y!==1&&(i=.5*(1-(this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y)),this.geometry.skinWeights[e].x+=i,this.geometry.skinWeights[e].y+=i)}},THREE.Ribbon=function(e,t){THREE.Object3D.call(this),this.geometry=e,this.materials=t instanceof Array?t:[t],this.flipSided=!1,this.doubleSided=!1},THREE.Ribbon.prototype=new THREE.Object3D,THREE.Ribbon.prototype.constructor=THREE.Ribbon,THREE.Sound=function(e,t,i,r){var n;for(THREE.Object3D.call(this),this.isLoaded=!1,this.isAddedToDOM=!1,this.isPlaying=!1,this.duration=-1,this.radius=void 0!==t?Math.abs(t):100,this.volume=Math.min(1,Math.max(0,void 0!==i?i:1)),this.domElement=document.createElement("audio"),this.domElement.volume=0,this.domElement.pan=0,this.domElement.loop=void 0===r||r,this.sources=e instanceof Array?e:[e],i=this.sources.length,e=0;e<i;e++)if(t=this.sources[e],t.toLowerCase(),-1!==t.indexOf(".mp3")?n="audio/mpeg":-1!==t.indexOf(".ogg")?n="audio/ogg":-1!==t.indexOf(".wav")&&(n="audio/wav"),this.domElement.canPlayType(n)){n=document.createElement("source"),n.src=this.sources[e],this.domElement.THREESound=this,this.domElement.appendChild(n),this.domElement.addEventListener("canplay",this.onLoad,!0),this.domElement.load();break}},THREE.Sound.prototype=new THREE.Object3D,THREE.Sound.prototype.constructor=THREE.Sound,THREE.Sound.prototype.supr=THREE.Object3D.prototype,THREE.Sound.prototype.onLoad=function(){var e=this.THREESound;e.isLoaded||(this.removeEventListener("canplay",this.onLoad,!0),e.isLoaded=!0,e.duration=this.duration,e.isPlaying&&e.play())},THREE.Sound.prototype.addToDOM=function(e){this.isAddedToDOM=!0,e.appendChild(this.domElement)},THREE.Sound.prototype.play=function(e){this.isPlaying=!0,this.isLoaded&&(this.domElement.play(),e&&(this.domElement.currentTime=e%this.duration))},THREE.Sound.prototype.pause=function(){this.isPlaying=!1,this.domElement.pause()},THREE.Sound.prototype.stop=function(){this.isPlaying=!1,this.domElement.pause(),this.domElement.currentTime=0},THREE.Sound.prototype.calculateVolumeAndPan=function(e){e=e.length(),this.domElement.volume=e<=this.radius?this.volume*(1-e/this.radius):0},THREE.Sound.prototype.update=function(e,t,i){this.matrixAutoUpdate&&(this.matrix.setPosition(this.position),t=!0),(t||this.matrixWorldNeedsUpdate)&&(e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var r=this.children.length;for(e=0;e<r;e++)this.children[e].update(this.matrixWorld,t,i)},THREE.LOD=function(){THREE.Object3D.call(this),this.LODs=[]},THREE.LOD.prototype=new THREE.Object3D,THREE.LOD.prototype.constructor=THREE.LOD,THREE.LOD.prototype.supr=THREE.Object3D.prototype,THREE.LOD.prototype.add=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=0;i<this.LODs.length&&!(t<this.LODs[i].visibleAtDistance);i++);this.LODs.splice(i,0,{visibleAtDistance:t,object3D:e}),this.addChild(e)},THREE.LOD.prototype.update=function(e,t,i){if(this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.matrixWorld.multiply(e,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0),this.LODs.length>1){e=i.matrixWorldInverse,e=-(e.n31*this.position.x+e.n32*this.position.y+e.n33*this.position.z+e.n34),this.LODs[0].object3D.visible=!0;for(var r=1;r<this.LODs.length&&e>=this.LODs[r].visibleAtDistance;r++)this.LODs[r-1].object3D.visible=!1,this.LODs[r].object3D.visible=!0;for(;r<this.LODs.length;r++)this.LODs[r].object3D.visible=!1}for(e=0;e<this.children.length;e++)this.children[e].update(this.matrixWorld,t,i)},THREE.ShadowVolume=function(e,t){e instanceof THREE.Mesh?(THREE.Mesh.call(this,e.geometry,[new THREE.ShadowVolumeDynamicMaterial]),e.addChild(this)):THREE.Mesh.call(this,e,[new THREE.ShadowVolumeDynamicMaterial]),this.calculateShadowVolumeGeometry()},THREE.ShadowVolume.prototype=new THREE.Mesh,THREE.ShadowVolume.prototype.constructor=THREE.ShadowVolume,THREE.ShadowVolume.prototype.supr=THREE.Mesh.prototype,THREE.ShadowVolume.prototype.calculateShadowVolumeGeometry=function(){if(this.geometry.edges&&this.geometry.edges.length){var e,t,i,r,n,o,a,s,h,l,c,f,E,u,d=new THREE.Geometry;d.vertices=this.geometry.vertices,r=d.faces=this.geometry.faces;var p=d.egdes=this.geometry.edges,m=d.edgeFaces=[];n=0;var g=[];for(e=0,t=r.length;e<t;e++)i=r[e],g.push(n),n+=i instanceof THREE.Face3?3:4,i.vertexNormals[0]=i.normal,i.vertexNormals[1]=i.normal,i.vertexNormals[2]=i.normal,i instanceof THREE.Face4&&(i.vertexNormals[3]=i.normal);for(e=0,t=p.length;e<t;e++)s=p[e],i=s.faces[0],r=s.faces[1],n=s.faceIndices[0],o=s.faceIndices[1],a=s.vertexIndices[0],s=s.vertexIndices[1],i.a===a?(h="a",c=g[n]+0):i.b===a?(h="b",c=g[n]+1):i.c===a?(h="c",c=g[n]+2):i.d===a&&(h="d",c=g[n]+3),i.a===s?(h+="a",f=g[n]+0):i.b===s?(h+="b",f=g[n]+1):i.c===s?(h+="c",f=g[n]+2):i.d===s&&(h+="d",f=g[n]+3),r.a===a?(l="a",E=g[o]+0):r.b===a?(l="b",E=g[o]+1):r.c===a?(l="c",E=g[o]+2):r.d===a&&(l="d",E=g[o]+3),r.a===s?(l+="a",u=g[o]+0):r.b===s?(l+="b",u=g[o]+1):r.c===s?(l+="c",u=g[o]+2):r.d===s&&(l+="d",u=g[o]+3),"ac"===h||"ad"===h||"ca"===h||"da"===h?c>f&&(i=c,c=f,f=i):c<f&&(i=c,c=f,f=i),"ac"===l||"ad"===l||"ca"===l||"da"===l?E>u&&(i=E,E=u,u=i):E<u&&(i=E,E=u,u=i),i=new THREE.Face4(c,f,E,u),i.normal.set(1,0,0),m.push(i);this.geometry=d}else this.calculateShadowVolumeGeometryWithoutEdgeInfo(this.geometry)},THREE.ShadowVolume.prototype.calculateShadowVolumeGeometryWithoutEdgeInfo=function(e){this.geometry=new THREE.Geometry,this.geometry.boundingSphere=e.boundingSphere,this.geometry.edgeFaces=[];var t=this.geometry.vertices,i=this.geometry.faces,r=this.geometry.edgeFaces,n=e.faces;e=e.vertices;var o,a,s,h,l,c=n.length,f=["a","b","c","d"];for(s=0;s<c;s++)for(a=t.length,o=n[s],o instanceof THREE.Face4?(h=4,a=new THREE.Face4(a,a+1,a+2,a+3)):(h=3,a=new THREE.Face3(a,a+1,a+2)),a.normal.copy(o.normal),i.push(a),a=0;a<h;a++)l=e[o[f[a]]],t.push(new THREE.Vertex(l.position.clone()));for(c=0;c<n.length-1;c++)for(e=i[c],o=c+1;o<n.length;o++)a=i[o],a=this.facesShareEdge(t,e,a),void 0!==a&&(a=new THREE.Face4(a.indices[0],a.indices[3],a.indices[2],a.indices[1]),a.normal.set(1,0,0),r.push(a))},THREE.ShadowVolume.prototype.facesShareEdge=function(e,t,i){var r,n,o,a,s,h,l,c,f,E,u,d,p,m=0,g=["a","b","c","d"];for(r=t instanceof THREE.Face4?4:3,n=i instanceof THREE.Face4?4:3,d=0;d<r;d++)for(o=t[g[d]],s=e[o],p=0;p<n;p++)if(a=i[g[p]],h=e[a],Math.abs(s.position.x-h.position.x)<1e-4&&Math.abs(s.position.y-h.position.y)<1e-4&&Math.abs(s.position.z-h.position.z)<1e-4&&(m++,1===m&&(l=s,c=h,f=o,E=a,u=g[d]),2===m))return u+=g[d],"ad"===u||"ac"===u?{faces:[t,i],vertices:[l,c,h,s],indices:[f,E,a,o],vertexTypes:[1,2,2,1],extrudable:!0}:{faces:[t,i],vertices:[l,s,h,c],indices:[f,o,a,E],vertexTypes:[1,1,2,2],extrudable:!0}},THREE.Scene=function(){THREE.Object3D.call(this),this.matrixAutoUpdate=!1,this.fog=null,this.objects=[],this.lights=[],this.sounds=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=new THREE.Object3D,THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.supr=THREE.Object3D.prototype,THREE.Scene.prototype.addChild=function(e){this.supr.addChild.call(this,e),this.addChildRecurse(e)},THREE.Scene.prototype.addChildRecurse=function(e){e instanceof THREE.Light?-1===this.lights.indexOf(e)&&this.lights.push(e):e instanceof THREE.Sound?-1===this.sounds.indexOf(e)&&this.sounds.push(e):e instanceof THREE.Camera||e instanceof THREE.Bone||-1!==this.objects.indexOf(e)||(this.objects.push(e),this.__objectsAdded.push(e));for(var t=0;t<e.children.length;t++)this.addChildRecurse(e.children[t])},THREE.Scene.prototype.removeChild=function(e){this.supr.removeChild.call(this,e),this.removeChildRecurse(e)},THREE.Scene.prototype.removeChildRecurse=function(e){if(e instanceof THREE.Light){var t=this.lights.indexOf(e);-1!==t&&this.lights.splice(t,1)}else e instanceof THREE.Sound?(t=this.sounds.indexOf(e),-1!==t&&this.sounds.splice(t,1)):e instanceof THREE.Camera||(t=this.objects.indexOf(e),-1!==t&&(this.objects.splice(t,1),this.__objectsRemoved.push(e)));for(t=0;t<e.children.length;t++)this.removeChildRecurse(e.children[t])},THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild,THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild,THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild,THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild,THREE.Fog=function(e,t,i){this.color=new THREE.Color(e),this.near=t||1,this.far=i||1e3},THREE.FogExp2=function(e,t){this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.Projector=function(){function e(){var e=p[a]=p[a]||new THREE.RenderableVertex;return a++,e}function t(e,t){return t.z-e.z}function i(e,t){var i=0,r=1,n=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return n>=0&&o>=0&&a>=0&&s>=0||!(n<0&&o<0||a<0&&s<0)&&(n<0?i=Math.max(i,n/(n-o)):o<0&&(r=Math.min(r,n/(n-o))),a<0?i=Math.max(i,a/(a-s)):s<0&&(r=Math.min(r,a/(a-s))),!(r<i)&&(e.lerpSelf(t,i),t.lerpSelf(e,1-r),!0))}var r,n,o,a,s,h,l,c,f,E,u,d=[],p=[],m=[],g=[],T=[],v=[],R=new THREE.Vector4,_=new THREE.Vector4,y=new THREE.Matrix4,x=new THREE.Matrix4,b=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],H=new THREE.Vector4,S=new THREE.Vector4;this.projectVector=function(e,t){return y.multiply(t.projectionMatrix,t.matrixWorldInverse),y.multiplyVector3(e),e},this.unprojectVector=function(e,t){return y.multiply(t.matrixWorld,THREE.Matrix4.makeInvert(t.projectionMatrix)),y.multiplyVector3(e),e},this.projectObjects=function(e,i,o){var a,s,h;for(i=[],n=0,s=e.objects,e=0,a=s.length;e<a;e++){var l;if(h=s[e],!(l=!h.visible)&&(l=h instanceof THREE.Mesh)){e:{l=void 0;for(var c=h.matrixWorld,f=-h.geometry.boundingSphere.radius*Math.max(h.scale.x,Math.max(h.scale.y,h.scale.z)),E=0;E<6;E++)if(l=b[E].x*c.n14+b[E].y*c.n24+b[E].z*c.n34+b[E].w,l<=f){l=!1;break e}l=!0}l=!l}l||(l=d[n]=d[n]||new THREE.RenderableObject,n++,r=l,R.copy(h.position),y.multiplyVector3(R),r.object=h,r.z=R.z,i.push(r))}return o&&i.sort(t),i},this.projectScene=function(r,n,d){var R,M,A,w,F,L,C,B,U,D,P,V,z,N,I,k,O,j=[],W=n.near,G=n.far;for(u=f=l=h=0,n.matrixAutoUpdate&&n.updateMatrix(),r.update(void 0,!1,n),y.multiply(n.projectionMatrix,n.matrixWorldInverse),b[0].set(y.n41-y.n11,y.n42-y.n12,y.n43-y.n13,y.n44-y.n14),b[1].set(y.n41+y.n11,y.n42+y.n12,y.n43+y.n13,y.n44+y.n14),b[2].set(y.n41+y.n21,y.n42+y.n22,y.n43+y.n23,y.n44+y.n24),b[3].set(y.n41-y.n21,y.n42-y.n22,y.n43-y.n23,y.n44-y.n24),b[4].set(y.n41-y.n31,y.n42-y.n32,y.n43-y.n33,y.n44-y.n34),b[5].set(y.n41+y.n31,y.n42+y.n32,y.n43+y.n33,y.n44+y.n34),R=0;R<6;R++)U=b[R],U.divideScalar(Math.sqrt(U.x*U.x+U.y*U.y+U.z*U.z));for(U=this.projectObjects(r,n,!0),r=0,R=U.length;r<R;r++)if(D=U[r].object,D.visible)if(P=D.matrixWorld,V=D.matrixRotationWorld,z=D.materials,N=D.overdraw,a=0,D instanceof THREE.Mesh){for(I=D.geometry,w=I.vertices,k=I.faces,I=I.faceVertexUvs,M=0,A=w.length;M<A;M++)o=e(),o.positionWorld.copy(w[M].position),P.multiplyVector3(o.positionWorld),o.positionScreen.copy(o.positionWorld),y.multiplyVector4(o.positionScreen),o.positionScreen.x/=o.positionScreen.w,o.positionScreen.y/=o.positionScreen.w,o.visible=o.positionScreen.z>W&&o.positionScreen.z<G;for(w=0,M=k.length;w<M;w++){if(A=k[w],A instanceof THREE.Face3){if(F=p[A.a],L=p[A.b],C=p[A.c],!(F.visible&&L.visible&&C.visible)||!D.doubleSided&&D.flipSided==(C.positionScreen.x-F.positionScreen.x)*(L.positionScreen.y-F.positionScreen.y)-(C.positionScreen.y-F.positionScreen.y)*(L.positionScreen.x-F.positionScreen.x)<0)continue;B=m[h]=m[h]||new THREE.RenderableFace3,h++,s=B,s.v1.copy(F),s.v2.copy(L),s.v3.copy(C)}else if(A instanceof THREE.Face4){if(F=p[A.a],L=p[A.b],C=p[A.c],B=p[A.d],!(F.visible&&L.visible&&C.visible&&B.visible)||!D.doubleSided&&D.flipSided==((B.positionScreen.x-F.positionScreen.x)*(L.positionScreen.y-F.positionScreen.y)-(B.positionScreen.y-F.positionScreen.y)*(L.positionScreen.x-F.positionScreen.x)<0||(L.positionScreen.x-C.positionScreen.x)*(B.positionScreen.y-C.positionScreen.y)-(L.positionScreen.y-C.positionScreen.y)*(B.positionScreen.x-C.positionScreen.x)<0))continue;O=g[l]=g[l]||new THREE.RenderableFace4,l++,s=O,s.v1.copy(F),s.v2.copy(L),s.v3.copy(C),s.v4.copy(B)}for(s.normalWorld.copy(A.normal),V.multiplyVector3(s.normalWorld),s.centroidWorld.copy(A.centroid),P.multiplyVector3(s.centroidWorld),s.centroidScreen.copy(s.centroidWorld),y.multiplyVector3(s.centroidScreen),C=A.vertexNormals,F=0,L=C.length;F<L;F++)B=s.vertexNormalsWorld[F],B.copy(C[F]),V.multiplyVector3(B);for(F=0,L=I.length;F<L;F++)if(O=I[F][w])for(C=0,B=O.length;C<B;C++)s.uvs[F][C]=O[C];s.meshMaterials=z,s.faceMaterials=A.materials,s.overdraw=N,s.z=s.centroidScreen.z,j.push(s)}}else if(D instanceof THREE.Line)for(x.multiply(y,P),w=D.geometry.vertices,F=e(),F.positionScreen.copy(w[0].position),x.multiplyVector4(F.positionScreen),M=1,A=w.length;M<A;M++)F=e(),F.positionScreen.copy(w[M].position),x.multiplyVector4(F.positionScreen),L=p[a-2],H.copy(F.positionScreen),S.copy(L.positionScreen),i(H,S)&&(H.multiplyScalar(1/H.w),S.multiplyScalar(1/S.w),P=T[f]=T[f]||new THREE.RenderableLine,f++,c=P,c.v1.positionScreen.copy(H),c.v2.positionScreen.copy(S),c.z=Math.max(H.z,S.z),c.materials=D.materials,j.push(c));else D instanceof THREE.Particle&&(_.set(D.position.x,D.position.y,D.position.z,1),y.multiplyVector4(_),_.z/=_.w,_.z>0&&_.z<1&&(P=v[u]=v[u]||new THREE.RenderableParticle,u++,E=P,E.x=_.x/_.w,E.y=_.y/_.w,E.z=_.z,E.rotation=D.rotation.z,E.scale.x=D.scale.x*Math.abs(E.x-(_.x+n.projectionMatrix.n11)/(_.w+n.projectionMatrix.n14)),E.scale.y=D.scale.y*Math.abs(E.y-(_.y+n.projectionMatrix.n22)/(_.w+n.projectionMatrix.n24)),E.materials=D.materials,j.push(E)));return d&&j.sort(t),j}},THREE.SoundRenderer=function(){this.volume=1,this.domElement=document.createElement("div"),this.domElement.id="THREESound",this.cameraPosition=new THREE.Vector3,this.soundPosition=new THREE.Vector3,this.render=function(e,t,i){i&&e.update(void 0,!1,t),i=e.sounds;var r,n=i.length;for(r=0;r<n;r++)e=i[r],this.soundPosition.set(e.matrixWorld.n14,e.matrixWorld.n24,e.matrixWorld.n34),this.soundPosition.subSelf(t.position),e.isPlaying&&e.isLoaded&&(e.isAddedToDOM||e.addToDOM(this.domElement),e.calculateVolumeAndPan(this.soundPosition))}},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",
lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif"},THREE.UniformsUtils={merge:function(e){var t,i,r,n={};for(t=0;t<e.length;t++)for(i in r=this.clone(e[t]),r)n[i]=r[i];return n},clone:function(e){var t,i,r,n={};for(t in e)for(i in n[t]={},e[t])r=e[t][i],n[t][i]=r instanceof THREE.Color||r instanceof THREE.Vector3||r instanceof THREE.Texture?r.clone():r;return n}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)},morphTargetInfluences:{type:"f",value:0}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}}},THREE.ShaderLib={lensFlareVertexTexture:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nuniform\tsampler2D\tocclusionMap;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvarying\tfloat\tvVisibility;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 )) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ));\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvarying\tfloat\t\tvVisibility;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * vVisibility;\ngl_FragColor = color;\n}\n}"},lensFlare:{vertexShader:"uniform \tvec3 \tscreenPosition;\nuniform\tvec2\tscale;\nuniform\tfloat\trotation;\nuniform    int     renderType;\nattribute \tvec2 \tposition;\nattribute  vec2\tUV;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4(( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tsampler2D\tocclusionMap;\nuniform\tfloat\t\topacity;\nuniform    int         renderType;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 )).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 )).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 )).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 )).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * visibility;\ngl_FragColor = color;\n}\n}"},sprite:{vertexShader:"uniform\tint\t\tuseScreenCoordinates;\nuniform    int     affectedByDistance;\nuniform\tvec3\tscreenPosition;\nuniform \tmat4 \tmodelViewMatrix;\nuniform \tmat4 \tprojectionMatrix;\nuniform    float   rotation;\nuniform    vec2    scale;\nuniform    vec2    alignment;\nuniform    vec2    uvOffset;\nuniform\tvec2    uvScale;\nattribute \tvec2 \tposition;\nattribute  vec2\tuv;\nvarying\tvec2\tvUV;\nvoid main(void)\n{\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform\tsampler2D\tmap;\nuniform\tfloat\t\topacity;\nvarying\tvec2\t\tvUV;\nvoid main( void )\n{\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}"},shadowPost:{vertexShader:"uniform \tmat4 \tprojectionMatrix;\nattribute \tvec3 \tposition;\nvoid main(void)\n{\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform \tfloat \tdarkness;\nvoid main( void )\n{\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform \tvec3 \tdirectionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm )), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0 );\n}"},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsLib.particle,fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}},THREE.WebGLRenderer=function(e){function t(e,t,i){var r,n,o,a=e.vertices,s=a.length,h=e.colors,l=h.length,c=e.__vertexArray,f=e.__colorArray,E=e.__sortArray,u=e.__dirtyVertices,d=e.__dirtyColors;if(i.sortParticles){for(G.multiplySelf(i.matrixWorld),r=0;r<s;r++)n=a[r].position,q.copy(n),G.multiplyVector3(q),E[r]=[q.z,r];for(E.sort(function(e,t){return t[0]-e[0]}),r=0;r<s;r++)n=a[E[r][1]].position,o=3*r,c[o]=n.x,c[o+1]=n.y,c[o+2]=n.z;for(r=0;r<l;r++)o=3*r,color=h[E[r][1]],f[o]=color.r,f[o+1]=color.g,f[o+2]=color.b}else{if(u)for(r=0;r<s;r++)n=a[r].position,o=3*r,c[o]=n.x,c[o+1]=n.y,c[o+2]=n.z;if(d)for(r=0;r<l;r++)color=h[r],o=3*r,f[o]=color.r,f[o+1]=color.g,f[o+2]=color.b}(u||i.sortParticles)&&(w.bindBuffer(w.ARRAY_BUFFER,e.__webglVertexBuffer),w.bufferData(w.ARRAY_BUFFER,c,t)),(d||i.sortParticles)&&(w.bindBuffer(w.ARRAY_BUFFER,e.__webglColorBuffer),w.bufferData(w.ARRAY_BUFFER,f,t))}function i(e,t,i,r,n){r.program||D.initMaterial(r,t,i,n);var o=r.program,a=o.uniforms,s=r.uniforms;if(o!=C&&(w.useProgram(o),C=o),w.uniformMatrix4fv(a.projectionMatrix,!1,X),i&&(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial||r instanceof THREE.LineBasicMaterial||r instanceof THREE.ParticleBasicMaterial||r.fog)&&(s.fogColor.value=i.color,i instanceof THREE.Fog?(s.fogNear.value=i.near,s.fogFar.value=i.far):i instanceof THREE.FogExp2&&(s.fogDensity.value=i.density)),r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){var h,l,c,f,E,u,d=0,p=0,m=0,g=K,T=g.directional.colors,v=g.directional.positions,R=g.point.colors,_=g.point.positions,y=g.point.distances,H=0,S=0;for(i=l=u=0,h=t.length;i<h;i++)l=t[i],c=l.color,f=l.position,E=l.intensity,u=l.distance,l instanceof THREE.AmbientLight?(d+=c.r,p+=c.g,m+=c.b):l instanceof THREE.DirectionalLight?(u=3*H,T[u]=c.r*E,T[u+1]=c.g*E,T[u+2]=c.b*E,v[u]=f.x,v[u+1]=f.y,v[u+2]=f.z,H+=1):l instanceof THREE.PointLight&&(l=3*S,R[l]=c.r*E,R[l+1]=c.g*E,R[l+2]=c.b*E,_[l]=f.x,_[l+1]=f.y,_[l+2]=f.z,y[S]=u,S+=1);for(i=3*H;i<T.length;i++)T[i]=0;for(i=3*S;i<R.length;i++)R[i]=0;g.point.length=S,g.directional.length=H,g.ambient[0]=d,g.ambient[1]=p,g.ambient[2]=m,i=K,s.enableLighting.value=i.directional.length+i.point.length,s.ambientLightColor.value=i.ambient,s.directionalLightColor.value=i.directional.colors,s.directionalLightDirection.value=i.directional.positions,s.pointLightColor.value=i.point.colors,s.pointLightPosition.value=i.point.positions,s.pointLightDistance.value=i.point.distances}for(var M in(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)&&(s.diffuse.value=r.color,s.opacity.value=r.opacity,s.map.texture=r.map,s.lightMap.texture=r.lightMap,s.envMap.texture=r.envMap,s.reflectivity.value=r.reflectivity,s.refractionRatio.value=r.refractionRatio,s.combine.value=r.combine,s.useRefract.value=r.envMap&&r.envMap.mapping instanceof THREE.CubeRefractionMapping),r instanceof THREE.LineBasicMaterial?(s.diffuse.value=r.color,s.opacity.value=r.opacity):r instanceof THREE.ParticleBasicMaterial?(s.psColor.value=r.color,s.opacity.value=r.opacity,s.size.value=r.size,s.scale.value=F.height/2,s.map.texture=r.map):r instanceof THREE.MeshPhongMaterial?(s.ambient.value=r.ambient,s.specular.value=r.specular,s.shininess.value=r.shininess):r instanceof THREE.MeshDepthMaterial?(s.mNear.value=e.near,s.mFar.value=e.far,s.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(s.opacity.value=r.opacity),s)if(p=o.uniforms[M])if(h=s[M],d=h.type,i=h.value,"i"==d)w.uniform1i(p,i);else if("f"==d)w.uniform1f(p,i);else if("fv1"==d)w.uniform1fv(p,i);else if("fv"==d)w.uniform3fv(p,i);else if("v2"==d)w.uniform2f(p,i.x,i.y);else if("v3"==d)w.uniform3f(p,i.x,i.y,i.z);else if("v4"==d)w.uniform4f(p,i.x,i.y,i.z,i.w);else if("c"==d)w.uniform3f(p,i.r,i.g,i.b);else if("t"==d&&(w.uniform1i(p,i),h=h.texture))if(h.image instanceof Array&&6==h.image.length){if(6==h.image.length){if(h.needsUpdate){if(h.__webglInit)for(w.bindTexture(w.TEXTURE_CUBE_MAP,h.image.__webglTextureCube),d=0;d<6;++d)w.texSubImage2D(w.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,0,0,w.RGBA,w.UNSIGNED_BYTE,h.image[d]);else{for(h.image.__webglTextureCube=w.createTexture(),w.bindTexture(w.TEXTURE_CUBE_MAP,h.image.__webglTextureCube),d=0;d<6;++d)w.texImage2D(w.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,h.image[d]);h.__webglInit=!0}x(w.TEXTURE_CUBE_MAP,h,h.image[0]),w.bindTexture(w.TEXTURE_CUBE_MAP,null),h.needsUpdate=!1}w.activeTexture(w.TEXTURE0+i),w.bindTexture(w.TEXTURE_CUBE_MAP,h.image.__webglTextureCube)}}else b(h,i);return w.uniformMatrix4fv(a.modelViewMatrix,!1,n._modelViewMatrixArray),w.uniformMatrix3fv(a.normalMatrix,!1,n._normalMatrixArray),(r instanceof THREE.MeshShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&w.uniform3f(a.cameraPosition,e.position.x,e.position.y,e.position.z),(r instanceof THREE.MeshShaderMaterial||r.envMap||r.skinning)&&w.uniformMatrix4fv(a.objectMatrix,!1,n._objectMatrixArray),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshShaderMaterial||r.skinning)&&w.uniformMatrix4fv(a.viewMatrix,!1,Y),r instanceof THREE.ShadowVolumeDynamicMaterial&&(e=s.directionalLightDirection.value,e[0]=-t[1].position.x,e[1]=-t[1].position.y,e[2]=-t[1].position.z,w.uniform3fv(a.directionalLightDirection,e),w.uniformMatrix4fv(a.objectMatrix,!1,n._objectMatrixArray),w.uniformMatrix4fv(a.viewMatrix,!1,Y)),r.skinning&&(w.uniformMatrix4fv(a.cameraInverseMatrix,!1,Y),w.uniformMatrix4fv(a.boneGlobalMatrices,!1,n.boneMatrices)),o}function r(e,t,r,n,o,a){if(0!=n.opacity){var s;if(e=i(e,t,r,n,a).attributes,n.morphTargets){if(t=n.program.attributes,-1!==a.morphTargetBase?w.bindBuffer(w.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[a.morphTargetBase]):w.bindBuffer(w.ARRAY_BUFFER,o.__webglVertexBuffer),w.vertexAttribPointer(t.position,3,w.FLOAT,!1,0,0),a.morphTargetForcedOrder.length){r=0;for(var h=a.morphTargetForcedOrder,l=a.morphTargetInfluences;r<n.numSupportedMorphTargets&&r<h.length;)w.bindBuffer(w.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[h[r]]),w.vertexAttribPointer(t["morphTarget"+r],3,w.FLOAT,!1,0,0),a.__webglMorphTargetInfluences[r]=l[h[r]],r++}else{h=[];var c=-1,f=0;l=a.morphTargetInfluences;var E,u=l.length;for(r=0,-1!==a.morphTargetBase&&(h[a.morphTargetBase]=!0);r<n.numSupportedMorphTargets;){for(E=0;E<u;E++)!h[E]&&l[E]>c&&(f=E,c=l[f]);w.bindBuffer(w.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[f]),w.vertexAttribPointer(t["morphTarget"+r],3,w.FLOAT,!1,0,0),a.__webglMorphTargetInfluences[r]=c,h[f]=1,c=-1,r++}}w.uniform1fv(n.program.uniforms.morphTargetInfluences,a.__webglMorphTargetInfluences)}else w.bindBuffer(w.ARRAY_BUFFER,o.__webglVertexBuffer),w.vertexAttribPointer(e.position,3,w.FLOAT,!1,0,0);if(o.__webglCustomAttributes)for(s in o.__webglCustomAttributes)e[s]>=0&&(t=o.__webglCustomAttributes[s],w.bindBuffer(w.ARRAY_BUFFER,t.buffer),w.vertexAttribPointer(e[s],t.size,w.FLOAT,!1,0,0));e.color>=0&&(w.bindBuffer(w.ARRAY_BUFFER,o.__webglColorBuffer),w.vertexAttribPointer(e.color,3,w.FLOAT,!1,0,0)),e.normal>=0&&(w.bindBuffer(w.ARRAY_BUFFER,o.__webglNormalBuffer),w.vertexAttribPointer(e.normal,3,w.FLOAT,!1,0,0)),e.tangent>=0&&(w.bindBuffer(w.ARRAY_BUFFER,o.__webglTangentBuffer),w.vertexAttribPointer(e.tangent,4,w.FLOAT,!1,0,0)),e.uv>=0&&(o.__webglUVBuffer?(w.bindBuffer(w.ARRAY_BUFFER,o.__webglUVBuffer),w.vertexAttribPointer(e.uv,2,w.FLOAT,!1,0,0),w.enableVertexAttribArray(e.uv)):w.disableVertexAttribArray(e.uv)),e.uv2>=0&&(o.__webglUV2Buffer?(w.bindBuffer(w.ARRAY_BUFFER,o.__webglUV2Buffer),w.vertexAttribPointer(e.uv2,2,w.FLOAT,!1,0,0),w.enableVertexAttribArray(e.uv2)):w.disableVertexAttribArray(e.uv2)),n.skinning&&e.skinVertexA>=0&&e.skinVertexB>=0&&e.skinIndex>=0&&e.skinWeight>=0&&(w.bindBuffer(w.ARRAY_BUFFER,o.__webglSkinVertexABuffer),w.vertexAttribPointer(e.skinVertexA,4,w.FLOAT,!1,0,0),w.bindBuffer(w.ARRAY_BUFFER,o.__webglSkinVertexBBuffer),w.vertexAttribPointer(e.skinVertexB,4,w.FLOAT,!1,0,0),w.bindBuffer(w.ARRAY_BUFFER,o.__webglSkinIndicesBuffer),w.vertexAttribPointer(e.skinIndex,4,w.FLOAT,!1,0,0),w.bindBuffer(w.ARRAY_BUFFER,o.__webglSkinWeightsBuffer),w.vertexAttribPointer(e.skinWeight,4,w.FLOAT,!1,0,0)),a instanceof THREE.Mesh?n.wireframe?(w.lineWidth(n.wireframeLinewidth),w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer),w.drawElements(w.LINES,o.__webglLineCount,w.UNSIGNED_SHORT,0)):(w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer),w.drawElements(w.TRIANGLES,o.__webglFaceCount,w.UNSIGNED_SHORT,0)):a instanceof THREE.Line?(a=a.type==THREE.LineStrip?w.LINE_STRIP:w.LINES,w.lineWidth(n.linewidth),w.drawArrays(a,0,o.__webglLineCount)):a instanceof THREE.ParticleSystem?w.drawArrays(w.POINTS,0,o.__webglParticleCount):a instanceof THREE.Ribbon&&w.drawArrays(w.TRIANGLE_STRIP,0,o.__webglVertexCount)}}function n(e,t,i){if(e.__webglVertexBuffer||(e.__webglVertexBuffer=w.createBuffer()),e.__webglNormalBuffer||(e.__webglNormalBuffer=w.createBuffer()),e.hasPos&&(w.bindBuffer(w.ARRAY_BUFFER,e.__webglVertexBuffer),w.bufferData(w.ARRAY_BUFFER,e.positionArray,w.DYNAMIC_DRAW),w.enableVertexAttribArray(t.attributes.position),w.vertexAttribPointer(t.attributes.position,3,w.FLOAT,!1,0,0)),e.hasNormal){if(w.bindBuffer(w.ARRAY_BUFFER,e.__webglNormalBuffer),i==THREE.FlatShading){var r,n,o,a,s,h,l,c,f,E,u=3*e.count;for(E=0;E<u;E+=9)i=e.normalArray,r=i[E],n=i[E+1],o=i[E+2],a=i[E+3],h=i[E+4],c=i[E+5],s=i[E+6],l=i[E+7],f=i[E+8],r=(r+a+s)/3,n=(n+h+l)/3,o=(o+c+f)/3,i[E]=r,i[E+1]=n,i[E+2]=o,i[E+3]=r,i[E+4]=n,i[E+5]=o,i[E+6]=r,i[E+7]=n,i[E+8]=o}w.bufferData(w.ARRAY_BUFFER,e.normalArray,w.DYNAMIC_DRAW),w.enableVertexAttribArray(t.attributes.normal),w.vertexAttribPointer(t.attributes.normal,3,w.FLOAT,!1,0,0)}w.drawArrays(w.TRIANGLES,0,e.count),e.count=0}function o(e){P!=e.doubleSided&&(e.doubleSided?w.disable(w.CULL_FACE):w.enable(w.CULL_FACE),P=e.doubleSided),V!=e.flipSided&&(e.flipSided?w.frontFace(w.CW):w.frontFace(w.CCW),V=e.flipSided)}function s(e){N!=e&&(e?w.enable(w.DEPTH_TEST):w.disable(w.DEPTH_TEST),N=e)}function h(e){var t;for(W[0].set(e.n41-e.n11,e.n42-e.n12,e.n43-e.n13,e.n44-e.n14),W[1].set(e.n41+e.n11,e.n42+e.n12,e.n43+e.n13,e.n44+e.n14),W[2].set(e.n41+e.n21,e.n42+e.n22,e.n43+e.n23,e.n44+e.n24),W[3].set(e.n41-e.n21,e.n42-e.n22,e.n43-e.n23,e.n44-e.n24),W[4].set(e.n41-e.n31,e.n42-e.n32,e.n43-e.n33,e.n44-e.n34),W[5].set(e.n41+e.n31,e.n42+e.n32,e.n43+e.n33,e.n44+e.n34),e=0;e<6;e++)t=W[e],t.divideScalar(Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z))}function c(e){for(var t=e.matrixWorld,i=-e.geometry.boundingSphere.radius*Math.max(e.scale.x,Math.max(e.scale.y,e.scale.z)),r=0;r<6;r++)if(e=W[r].x*t.n14+W[r].y*t.n24+W[r].z*t.n34+W[r].w,e<=i)return!1;return!0}function f(e,t){e.list[e.count]=t,e.count+=1}function E(e){var t,i,r=e.object,n=e.opaque,o=e.transparent;for(o.count=0,e=n.count=0,t=r.materials.length;e<t;e++)i=r.materials[e],i.transparent?f(o,i):f(n,i)}function u(e){var t,i,r,n,o=e.object,a=e.buffer,s=e.opaque,h=e.transparent;for(h.count=0,e=s.count=0,r=o.materials.length;e<r;e++)if(t=o.materials[e],t instanceof THREE.MeshFaceMaterial)for(t=0,i=a.materials.length;t<i;t++)(n=a.materials[t])&&(n.transparent?f(h,n):f(s,n));else(n=t)&&(n.transparent?f(h,n):f(s,n))}function d(e,t){return t.z-e.z}function p(e){w.enable(w.POLYGON_OFFSET_FILL),w.polygonOffset(.1,1),w.enable(w.STENCIL_TEST),w.enable(w.DEPTH_TEST),w.depthMask(!1),w.colorMask(!1,!1,!1,!1),w.stencilFunc(w.ALWAYS,1,255),w.stencilOpSeparate(w.BACK,w.KEEP,w.INCR,w.KEEP),w.stencilOpSeparate(w.FRONT,w.KEEP,w.DECR,w.KEEP);var t,i,r,n,o,a,s,h=e.lights.length,l=e.lights,c=[],f=e.__webglShadowVolumes.length;for(t=0;t<h;t++)if(i=e.lights[t],i instanceof THREE.DirectionalLight)for(c[0]=-i.position.x,c[1]=-i.position.y,c[2]=-i.position.z,s=0;s<f;s++)i=e.__webglShadowVolumes[s].object,r=e.__webglShadowVolumes[s].buffer,n=i.materials[0],n.program||D.initMaterial(n,l,void 0,i),n=n.program,o=n.uniforms,a=n.attributes,C!==n&&(w.useProgram(n),C=n,w.uniformMatrix4fv(o.projectionMatrix,!1,X),w.uniformMatrix4fv(o.viewMatrix,!1,Y),w.uniform3fv(o.directionalLightDirection,c)),i.matrixWorld.flattenToArray(i._objectMatrixArray),w.uniformMatrix4fv(o.objectMatrix,!1,i._objectMatrixArray),w.bindBuffer(w.ARRAY_BUFFER,r.__webglVertexBuffer),w.vertexAttribPointer(a.position,3,w.FLOAT,!1,0,0),w.bindBuffer(w.ARRAY_BUFFER,r.__webglNormalBuffer),w.vertexAttribPointer(a.normal,3,w.FLOAT,!1,0,0),w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,r.__webglFaceBuffer),w.cullFace(w.FRONT),w.drawElements(w.TRIANGLES,r.__webglFaceCount,w.UNSIGNED_SHORT,0),w.cullFace(w.BACK),w.drawElements(w.TRIANGLES,r.__webglFaceCount,w.UNSIGNED_SHORT,0);w.disable(w.POLYGON_OFFSET_FILL),w.colorMask(!0,!0,!0,!0),w.stencilFunc(w.NOTEQUAL,0,255),w.stencilOp(w.KEEP,w.KEEP,w.KEEP),w.disable(w.DEPTH_TEST),z="",C=Q.program,w.useProgram(Q.program),w.uniformMatrix4fv(Q.projectionLocation,!1,X),w.uniform1f(Q.darknessLocation,Q.darkness),w.bindBuffer(w.ARRAY_BUFFER,Q.vertexBuffer),w.vertexAttribPointer(Q.vertexLocation,3,w.FLOAT,!1,0,0),w.enableVertexAttribArray(Q.vertexLocation),w.blendFunc(w.ONE,w.ONE_MINUS_SRC_ALPHA),w.blendEquation(w.FUNC_ADD),w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,Q.elementBuffer),w.drawElements(w.TRIANGLES,6,w.UNSIGNED_SHORT,0),w.disable(w.STENCIL_TEST),w.enable(w.DEPTH_TEST),w.depthMask(U)}function m(e,t){var i,r,n;i=_sprite.attributes;var o,a=_sprite.uniforms,s=j/O,h=[],l=.5*O,c=.5*j,f=!0;for(w.useProgram(_sprite.program),C=_sprite.program,z="",$||(w.enableVertexAttribArray(_sprite.attributes.position),w.enableVertexAttribArray(_sprite.attributes.uv),$=!0),w.disable(w.CULL_FACE),w.enable(w.BLEND),w.depthMask(!0),w.bindBuffer(w.ARRAY_BUFFER,_sprite.vertexBuffer),w.vertexAttribPointer(i.position,2,w.FLOAT,!1,16,0),w.vertexAttribPointer(i.uv,2,w.FLOAT,!1,16,8),w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer),w.uniformMatrix4fv(a.projectionMatrix,!1,X),w.activeTexture(w.TEXTURE0),w.uniform1i(a.map,0),i=0,r=e.__webglSprites.length;i<r;i++)n=e.__webglSprites[i],n.useScreenCoordinates?n.z=-n.position.z:(n._modelViewMatrix.multiplyToArray(t.matrixWorldInverse,n.matrixWorld,n._modelViewMatrixArray),n.z=-n._modelViewMatrix.n34);for(e.__webglSprites.sort(d),i=0,r=e.__webglSprites.length;i<r;i++)n=e.__webglSprites[i],void 0===n.material&&n.map&&n.map.image&&n.map.image.width&&(n.useScreenCoordinates?(w.uniform1i(a.useScreenCoordinates,1),w.uniform3f(a.screenPosition,(n.position.x-l)/l,(c-n.position.y)/c,Math.max(0,Math.min(1,n.position.z)))):(w.uniform1i(a.useScreenCoordinates,0),w.uniform1i(a.affectedByDistance,n.affectedByDistance?1:0),w.uniformMatrix4fv(a.modelViewMatrix,!1,n._modelViewMatrixArray)),o=n.map.image.width/(n.affectedByDistance?1:j),h[0]=o*s*n.scale.x,h[1]=o*n.scale.y,w.uniform2f(a.uvScale,n.uvScale.x,n.uvScale.y),w.uniform2f(a.uvOffset,n.uvOffset.x,n.uvOffset.y),w.uniform2f(a.alignment,n.alignment.x,n.alignment.y),w.uniform1f(a.opacity,n.opacity),w.uniform1f(a.rotation,n.rotation),w.uniform2fv(a.scale,h),n.mergeWith3D&&!f?(w.enable(w.DEPTH_TEST),f=!0):!n.mergeWith3D&&f&&(w.disable(w.DEPTH_TEST),f=!1),y(n.blending),b(n.map,0),w.drawElements(w.TRIANGLES,6,w.UNSIGNED_SHORT,0));w.enable(w.CULL_FACE),w.enable(w.DEPTH_TEST),w.depthMask(U)}function g(e,t){var i,r,n,o,a,s=e.__webglLensFlares.length,h=new THREE.Vector3,l=j/O,c=.5*O,f=.5*j,E=16/j,u=[E*l,E],d=[1,1,0],p=[1,1],m=Z.uniforms;for(i=Z.attributes,w.useProgram(Z.program),C=Z.program,z="",J||(w.enableVertexAttribArray(Z.attributes.vertex),w.enableVertexAttribArray(Z.attributes.uv),J=!0),w.uniform1i(m.occlusionMap,0),w.uniform1i(m.map,1),w.bindBuffer(w.ARRAY_BUFFER,Z.vertexBuffer),w.vertexAttribPointer(i.vertex,2,w.FLOAT,!1,16,0),w.vertexAttribPointer(i.uv,2,w.FLOAT,!1,16,8),w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,Z.elementBuffer),w.disable(w.CULL_FACE),w.depthMask(!1),w.activeTexture(w.TEXTURE0),
w.bindTexture(w.TEXTURE_2D,Z.occlusionTexture),w.activeTexture(w.TEXTURE1),r=0;r<s;r++)if(i=e.__webglLensFlares[r].object,h.set(i.matrixWorld.n14,i.matrixWorld.n24,i.matrixWorld.n34),t.matrixWorldInverse.multiplyVector3(h),t.projectionMatrix.multiplyVector3(h),d[0]=h.x,d[1]=h.y,d[2]=h.z,p[0]=d[0]*c+c,p[1]=d[1]*f+f,Z.hasVertexTexture||p[0]>0&&p[0]<O&&p[1]>0&&p[1]<j)for(w.bindTexture(w.TEXTURE_2D,Z.tempTexture),w.copyTexImage2D(w.TEXTURE_2D,0,w.RGB,p[0]-8,p[1]-8,16,16,0),w.uniform1i(m.renderType,0),w.uniform2fv(m.scale,u),w.uniform3fv(m.screenPosition,d),w.disable(w.BLEND),w.enable(w.DEPTH_TEST),w.drawElements(w.TRIANGLES,6,w.UNSIGNED_SHORT,0),w.bindTexture(w.TEXTURE_2D,Z.occlusionTexture),w.copyTexImage2D(w.TEXTURE_2D,0,w.RGBA,p[0]-8,p[1]-8,16,16,0),w.uniform1i(m.renderType,1),w.disable(w.DEPTH_TEST),w.bindTexture(w.TEXTURE_2D,Z.tempTexture),w.drawElements(w.TRIANGLES,6,w.UNSIGNED_SHORT,0),i.positionScreen.x=d[0],i.positionScreen.y=d[1],i.positionScreen.z=d[2],i.customUpdateCallback?i.customUpdateCallback(i):i.updateLensFlares(),w.uniform1i(m.renderType,2),w.enable(w.BLEND),n=0,o=i.lensFlares.length;n<o;n++)a=i.lensFlares[n],a.opacity>.001&&a.scale>.001&&(d[0]=a.x,d[1]=a.y,d[2]=a.z,E=a.size*a.scale/j,u[0]=E*l,u[1]=E,w.uniform3fv(m.screenPosition,d),w.uniform2fv(m.scale,u),w.uniform1f(m.rotation,a.rotation),w.uniform1f(m.opacity,a.opacity),y(a.blending),b(a.texture,1),w.drawElements(w.TRIANGLES,6,w.UNSIGNED_SHORT,0));w.enable(w.CULL_FACE),w.enable(w.DEPTH_TEST),w.depthMask(U)}function T(e,t){e._modelViewMatrix.multiplyToArray(t.matrixWorldInverse,e.matrixWorld,e._modelViewMatrixArray),THREE.Matrix4.makeInvert3x3(e._modelViewMatrix).transposeIntoArray(e._normalMatrixArray)}function v(e){var i,r,n,o,a;if(e instanceof THREE.Mesh){for(i in r=e.geometry,r.geometryGroups){for(o in n=r.geometryGroups[i],a=!1,n.__webglCustomAttributes)if(n.__webglCustomAttributes[o].needsUpdate){a=!0;break}if(r.__dirtyVertices||r.__dirtyMorphTargets||r.__dirtyElements||r.__dirtyUvs||r.__dirtyNormals||r.__dirtyColors||r.__dirtyTangents||a){a=w.DYNAMIC_DRAW;var s=void 0,h=void 0,l=void 0,c=void 0;l=void 0;var f=void 0,E=void 0,u=void 0,d=void 0,p=void 0,m=void 0,g=void 0,T=void 0,v=void 0,R=void 0,_=void 0,y=void 0,x=void 0;E=void 0,u=void 0,c=void 0,d=void 0,c=void 0;var b=void 0,H=void 0;E=void 0,b=void 0,H=void 0;var S=void 0,M=void 0;b=void 0,H=void 0,S=void 0,M=void 0,b=void 0,H=void 0,S=void 0,M=void 0,b=void 0,H=void 0,S=void 0,c=void 0,d=void 0,f=void 0,l=void 0,l=void 0,b=void 0,H=void 0,S=void 0;var A=void 0,F=0,L=0,C=0,B=0,U=0,D=0,P=0,V=0,z=0,N=0,I=0;H=b=0;var k=n.__vertexArray,O=n.__uvArray,j=n.__uv2Array,W=n.__normalArray,G=n.__tangentArray,X=n.__colorArray,Y=n.__skinVertexAArray,q=n.__skinVertexBArray,K=n.__skinIndexArray,Q=n.__skinWeightArray,Z=n.__morphTargetsArrays,J=n.__webglCustomAttributes;S=void 0;var $=n.__faceArray,ee=n.__lineArray,te=n.__needsSmoothNormals;m=n.__vertexColorType,p=n.__uvType,g=n.__normalType;var ie=e.geometry,re=ie.__dirtyVertices,ne=ie.__dirtyElements,oe=ie.__dirtyUvs,ae=ie.__dirtyNormals,se=ie.__dirtyTangents,he=ie.__dirtyColors,le=ie.__dirtyMorphTargets,ce=ie.vertices,fe=n.faces,Ee=ie.faces,ue=ie.faceVertexUvs[0],de=ie.faceVertexUvs[1],pe=ie.skinVerticesA,me=ie.skinVerticesB,ge=ie.skinIndices,Te=ie.skinWeights,ve=e instanceof THREE.ShadowVolume?ie.edgeFaces:void 0;if(morphTargets=ie.morphTargets,J)for(A in J)J[A].offset=0,J[A].offsetSrc=0;for(s=0,h=fe.length;s<h;s++)if(l=fe[s],c=Ee[l],ue&&(T=ue[l]),de&&(v=de[l]),l=c.vertexNormals,f=c.normal,E=c.vertexColors,u=c.color,d=c.vertexTangents,c instanceof THREE.Face3){if(re&&(R=ce[c.a].position,_=ce[c.b].position,y=ce[c.c].position,k[L]=R.x,k[L+1]=R.y,k[L+2]=R.z,k[L+3]=_.x,k[L+4]=_.y,k[L+5]=_.z,k[L+6]=y.x,k[L+7]=y.y,k[L+8]=y.z,L+=9),J)for(A in J)S=J[A],S.needsUpdate&&(b=S.offset,H=S.offsetSrc,1===S.size?(void 0===S.boundTo||"vertices"===S.boundTo?(S.array[b+0]=S.value[c.a],S.array[b+1]=S.value[c.b],S.array[b+2]=S.value[c.c]):"faces"===S.boundTo?(S.array[b+0]=S.value[H],S.array[b+1]=S.value[H],S.array[b+2]=S.value[H],S.offsetSrc++):"faceVertices"===S.boundTo&&(S.array[b+0]=S.value[H+0],S.array[b+1]=S.value[H+1],S.array[b+2]=S.value[H+2],S.offsetSrc+=3),S.offset+=3):(void 0===S.boundTo||"vertices"===S.boundTo?(R=S.value[c.a],_=S.value[c.b],y=S.value[c.c]):"faces"===S.boundTo?(R=S.value[H],_=S.value[H],y=S.value[H],S.offsetSrc++):"faceVertices"===S.boundTo&&(R=S.value[H+0],_=S.value[H+1],y=S.value[H+2],S.offsetSrc+=3),2===S.size?(S.array[b+0]=R.x,S.array[b+1]=R.y,S.array[b+2]=_.x,S.array[b+3]=_.y,S.array[b+4]=y.x,S.array[b+5]=y.y,S.offset+=6):3===S.size?("c"===S.type?(S.array[b+0]=R.r,S.array[b+1]=R.g,S.array[b+2]=R.b,S.array[b+3]=_.r,S.array[b+4]=_.g,S.array[b+5]=_.b,S.array[b+6]=y.r,S.array[b+7]=y.g,S.array[b+8]=y.b):(S.array[b+0]=R.x,S.array[b+1]=R.y,S.array[b+2]=R.z,S.array[b+3]=_.x,S.array[b+4]=_.y,S.array[b+5]=_.z,S.array[b+6]=y.x,S.array[b+7]=y.y,S.array[b+8]=y.z),S.offset+=9):(S.array[b+0]=R.x,S.array[b+1]=R.y,S.array[b+2]=R.z,S.array[b+3]=R.w,S.array[b+4]=_.x,S.array[b+5]=_.y,S.array[b+6]=_.z,S.array[b+7]=_.w,S.array[b+8]=y.x,S.array[b+9]=y.y,S.array[b+10]=y.z,S.array[b+11]=y.w,S.offset+=12)));if(le){for(b=0,H=morphTargets.length;b<H;b++)R=morphTargets[b].vertices[c.a].position,_=morphTargets[b].vertices[c.b].position,y=morphTargets[b].vertices[c.c].position,S=Z[b],S[I+0]=R.x,S[I+1]=R.y,S[I+2]=R.z,S[I+3]=_.x,S[I+4]=_.y,S[I+5]=_.z,S[I+6]=y.x,S[I+7]=y.y,S[I+8]=y.z;I+=9}if(Te.length&&(b=Te[c.a],H=Te[c.b],S=Te[c.c],Q[N]=b.x,Q[N+1]=b.y,Q[N+2]=b.z,Q[N+3]=b.w,Q[N+4]=H.x,Q[N+5]=H.y,Q[N+6]=H.z,Q[N+7]=H.w,Q[N+8]=S.x,Q[N+9]=S.y,Q[N+10]=S.z,Q[N+11]=S.w,b=ge[c.a],H=ge[c.b],S=ge[c.c],K[N]=b.x,K[N+1]=b.y,K[N+2]=b.z,K[N+3]=b.w,K[N+4]=H.x,K[N+5]=H.y,K[N+6]=H.z,K[N+7]=H.w,K[N+8]=S.x,K[N+9]=S.y,K[N+10]=S.z,K[N+11]=S.w,b=pe[c.a],H=pe[c.b],S=pe[c.c],Y[N]=b.x,Y[N+1]=b.y,Y[N+2]=b.z,Y[N+3]=1,Y[N+4]=H.x,Y[N+5]=H.y,Y[N+6]=H.z,Y[N+7]=1,Y[N+8]=S.x,Y[N+9]=S.y,Y[N+10]=S.z,Y[N+11]=1,b=me[c.a],H=me[c.b],S=me[c.c],q[N]=b.x,q[N+1]=b.y,q[N+2]=b.z,q[N+3]=1,q[N+4]=H.x,q[N+5]=H.y,q[N+6]=H.z,q[N+7]=1,q[N+8]=S.x,q[N+9]=S.y,q[N+10]=S.z,q[N+11]=1,N+=12),he&&m&&(3==E.length&&m==THREE.VertexColors?(c=E[0],b=E[1],H=E[2]):H=b=c=u,X[z]=c.r,X[z+1]=c.g,X[z+2]=c.b,X[z+3]=b.r,X[z+4]=b.g,X[z+5]=b.b,X[z+6]=H.r,X[z+7]=H.g,X[z+8]=H.b,z+=9),se&&ie.hasTangents&&(E=d[0],u=d[1],c=d[2],G[P]=E.x,G[P+1]=E.y,G[P+2]=E.z,G[P+3]=E.w,G[P+4]=u.x,G[P+5]=u.y,G[P+6]=u.z,G[P+7]=u.w,G[P+8]=c.x,G[P+9]=c.y,G[P+10]=c.z,G[P+11]=c.w,P+=12),ae&&g)if(3==l.length&&te)for(d=0;d<3;d++)f=l[d],W[D]=f.x,W[D+1]=f.y,W[D+2]=f.z,D+=3;else for(d=0;d<3;d++)W[D]=f.x,W[D+1]=f.y,W[D+2]=f.z,D+=3;if(oe&&void 0!==T&&p)for(d=0;d<3;d++)l=T[d],O[C]=l.u,O[C+1]=l.v,C+=2;if(oe&&void 0!==v&&p)for(d=0;d<3;d++)l=v[d],j[B]=l.u,j[B+1]=l.v,B+=2;ne&&($[U]=F,$[U+1]=F+1,$[U+2]=F+2,U+=3,ee[V]=F,ee[V+1]=F+1,ee[V+2]=F,ee[V+3]=F+2,ee[V+4]=F+1,ee[V+5]=F+2,V+=6,F+=3)}else if(c instanceof THREE.Face4){if(re&&(R=ce[c.a].position,_=ce[c.b].position,y=ce[c.c].position,x=ce[c.d].position,k[L]=R.x,k[L+1]=R.y,k[L+2]=R.z,k[L+3]=_.x,k[L+4]=_.y,k[L+5]=_.z,k[L+6]=y.x,k[L+7]=y.y,k[L+8]=y.z,k[L+9]=x.x,k[L+10]=x.y,k[L+11]=x.z,L+=12),J)for(A in J)S=J[A],S.needsUpdate&&(b=S.offset,H=S.offsetSrc,1===S.size?(void 0===S.boundTo||"vertices"===S.boundTo?(S.array[b+0]=S.value[c.a],S.array[b+1]=S.value[c.b],S.array[b+2]=S.value[c.c],S.array[b+2]=S.value[c.d]):"faces"===S.boundTo?(S.array[b+0]=S.value[H],S.array[b+1]=S.value[H],S.array[b+2]=S.value[H],S.array[b+2]=S.value[H],S.offsetSrc++):"faceVertices"===S.boundTo&&(S.array[b+0]=S.value[H+0],S.array[b+1]=S.value[H+1],S.array[b+2]=S.value[H+2],S.array[b+2]=S.value[H+3],S.offsetSrc+=4),S.offset+=4):(void 0===S.boundTo||"vertices"===S.boundTo?(R=S.value[c.a],_=S.value[c.b],y=S.value[c.c],x=S.value[c.d]):"faces"===S.boundTo?(R=S.value[H],_=S.value[H],y=S.value[H],x=S.value[H],S.offsetSrc++):"faceVertices"===S.boundTo&&(R=S.value[H+0],_=S.value[H+1],y=S.value[H+2],x=S.value[H+3],S.offsetSrc+=4),2===S.size?(S.array[b+0]=R.x,S.array[b+1]=R.y,S.array[b+2]=_.x,S.array[b+3]=_.y,S.array[b+4]=y.x,S.array[b+5]=y.y,S.array[b+6]=x.x,S.array[b+7]=x.y,S.offset+=8):3===S.size?("c"===S.type?(S.array[b+0]=R.r,S.array[b+1]=R.g,S.array[b+2]=R.b,S.array[b+3]=_.r,S.array[b+4]=_.g,S.array[b+5]=_.b,S.array[b+6]=y.r,S.array[b+7]=y.g,S.array[b+8]=y.b,S.array[b+9]=x.r,S.array[b+10]=x.g,S.array[b+11]=x.b):(S.array[b+0]=R.x,S.array[b+1]=R.y,S.array[b+2]=R.z,S.array[b+3]=_.x,S.array[b+4]=_.y,S.array[b+5]=_.z,S.array[b+6]=y.x,S.array[b+7]=y.y,S.array[b+8]=y.z,S.array[b+9]=x.x,S.array[b+10]=x.y,S.array[b+11]=x.z),S.offset+=12):(S.array[b+0]=R.x,S.array[b+1]=R.y,S.array[b+2]=R.z,S.array[b+3]=R.w,S.array[b+4]=_.x,S.array[b+5]=_.y,S.array[b+6]=_.z,S.array[b+7]=_.w,S.array[b+8]=y.x,S.array[b+9]=y.y,S.array[b+10]=y.z,S.array[b+11]=y.w,S.array[b+12]=x.x,S.array[b+13]=x.y,S.array[b+14]=x.z,S.array[b+15]=x.w,S.offset+=16)));if(le){for(b=0,H=morphTargets.length;b<H;b++)R=morphTargets[b].vertices[c.a].position,_=morphTargets[b].vertices[c.b].position,y=morphTargets[b].vertices[c.c].position,x=morphTargets[b].vertices[c.d].position,S=Z[b],S[I+0]=R.x,S[I+1]=R.y,S[I+2]=R.z,S[I+3]=_.x,S[I+4]=_.y,S[I+5]=_.z,S[I+6]=y.x,S[I+7]=y.y,S[I+8]=y.z,S[I+9]=x.x,S[I+10]=x.y,S[I+11]=x.z;I+=12}if(Te.length&&(b=Te[c.a],H=Te[c.b],S=Te[c.c],M=Te[c.d],Q[N]=b.x,Q[N+1]=b.y,Q[N+2]=b.z,Q[N+3]=b.w,Q[N+4]=H.x,Q[N+5]=H.y,Q[N+6]=H.z,Q[N+7]=H.w,Q[N+8]=S.x,Q[N+9]=S.y,Q[N+10]=S.z,Q[N+11]=S.w,Q[N+12]=M.x,Q[N+13]=M.y,Q[N+14]=M.z,Q[N+15]=M.w,b=ge[c.a],H=ge[c.b],S=ge[c.c],M=ge[c.d],K[N]=b.x,K[N+1]=b.y,K[N+2]=b.z,K[N+3]=b.w,K[N+4]=H.x,K[N+5]=H.y,K[N+6]=H.z,K[N+7]=H.w,K[N+8]=S.x,K[N+9]=S.y,K[N+10]=S.z,K[N+11]=S.w,K[N+12]=M.x,K[N+13]=M.y,K[N+14]=M.z,K[N+15]=M.w,b=pe[c.a],H=pe[c.b],S=pe[c.c],M=pe[c.d],Y[N]=b.x,Y[N+1]=b.y,Y[N+2]=b.z,Y[N+3]=1,Y[N+4]=H.x,Y[N+5]=H.y,Y[N+6]=H.z,Y[N+7]=1,Y[N+8]=S.x,Y[N+9]=S.y,Y[N+10]=S.z,Y[N+11]=1,Y[N+12]=M.x,Y[N+13]=M.y,Y[N+14]=M.z,Y[N+15]=1,b=me[c.a],H=me[c.b],S=me[c.c],c=me[c.d],q[N]=b.x,q[N+1]=b.y,q[N+2]=b.z,q[N+3]=1,q[N+4]=H.x,q[N+5]=H.y,q[N+6]=H.z,q[N+7]=1,q[N+8]=S.x,q[N+9]=S.y,q[N+10]=S.z,q[N+11]=1,q[N+12]=c.x,q[N+13]=c.y,q[N+14]=c.z,q[N+15]=1,N+=16),he&&m&&(4==E.length&&m==THREE.VertexColors?(c=E[0],b=E[1],H=E[2],E=E[3]):E=H=b=c=u,X[z]=c.r,X[z+1]=c.g,X[z+2]=c.b,X[z+3]=b.r,X[z+4]=b.g,X[z+5]=b.b,X[z+6]=H.r,X[z+7]=H.g,X[z+8]=H.b,X[z+9]=E.r,X[z+10]=E.g,X[z+11]=E.b,z+=12),se&&ie.hasTangents&&(E=d[0],u=d[1],c=d[2],d=d[3],G[P]=E.x,G[P+1]=E.y,G[P+2]=E.z,G[P+3]=E.w,G[P+4]=u.x,G[P+5]=u.y,G[P+6]=u.z,G[P+7]=u.w,G[P+8]=c.x,G[P+9]=c.y,G[P+10]=c.z,G[P+11]=c.w,G[P+12]=d.x,G[P+13]=d.y,G[P+14]=d.z,G[P+15]=d.w,P+=16),ae&&g)if(4==l.length&&te)for(d=0;d<4;d++)f=l[d],W[D]=f.x,W[D+1]=f.y,W[D+2]=f.z,D+=3;else for(d=0;d<4;d++)W[D]=f.x,W[D+1]=f.y,W[D+2]=f.z,D+=3;if(oe&&void 0!==T&&p)for(d=0;d<4;d++)l=T[d],O[C]=l.u,O[C+1]=l.v,C+=2;if(oe&&void 0!==v&&p)for(d=0;d<4;d++)l=v[d],j[B]=l.u,j[B+1]=l.v,B+=2;ne&&($[U]=F,$[U+1]=F+1,$[U+2]=F+3,$[U+3]=F+1,$[U+4]=F+2,$[U+5]=F+3,U+=6,ee[V]=F,ee[V+1]=F+1,ee[V+2]=F,ee[V+3]=F+3,ee[V+4]=F+1,ee[V+5]=F+2,ee[V+6]=F+2,ee[V+7]=F+3,V+=8,F+=4)}if(ve)for(s=0,h=ve.length;s<h;s++)$[U]=ve[s].a,$[U+1]=ve[s].b,$[U+2]=ve[s].c,$[U+3]=ve[s].a,$[U+4]=ve[s].c,$[U+5]=ve[s].d,U+=6;if(re&&(w.bindBuffer(w.ARRAY_BUFFER,n.__webglVertexBuffer),w.bufferData(w.ARRAY_BUFFER,k,a)),J)for(A in J)S=J[A],S.needsUpdate&&(w.bindBuffer(w.ARRAY_BUFFER,S.buffer),w.bufferData(w.ARRAY_BUFFER,S.array,a),S.needsUpdate=!1);if(le)for(b=0,H=morphTargets.length;b<H;b++)w.bindBuffer(w.ARRAY_BUFFER,n.__webglMorphTargetsBuffers[b]),w.bufferData(w.ARRAY_BUFFER,Z[b],a);he&&z>0&&(w.bindBuffer(w.ARRAY_BUFFER,n.__webglColorBuffer),w.bufferData(w.ARRAY_BUFFER,X,a)),ae&&(w.bindBuffer(w.ARRAY_BUFFER,n.__webglNormalBuffer),w.bufferData(w.ARRAY_BUFFER,W,a)),se&&ie.hasTangents&&(w.bindBuffer(w.ARRAY_BUFFER,n.__webglTangentBuffer),w.bufferData(w.ARRAY_BUFFER,G,a)),oe&&C>0&&(w.bindBuffer(w.ARRAY_BUFFER,n.__webglUVBuffer),w.bufferData(w.ARRAY_BUFFER,O,a)),oe&&B>0&&(w.bindBuffer(w.ARRAY_BUFFER,n.__webglUV2Buffer),w.bufferData(w.ARRAY_BUFFER,j,a)),ne&&(w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,$,a),w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,ee,a)),N>0&&(w.bindBuffer(w.ARRAY_BUFFER,n.__webglSkinVertexABuffer),w.bufferData(w.ARRAY_BUFFER,Y,a),w.bindBuffer(w.ARRAY_BUFFER,n.__webglSkinVertexBBuffer),w.bufferData(w.ARRAY_BUFFER,q,a),w.bindBuffer(w.ARRAY_BUFFER,n.__webglSkinIndicesBuffer),w.bufferData(w.ARRAY_BUFFER,K,a),w.bindBuffer(w.ARRAY_BUFFER,n.__webglSkinWeightsBuffer),w.bufferData(w.ARRAY_BUFFER,Q,a))}}r.__dirtyVertices=!1,r.__dirtyMorphTargets=!1,r.__dirtyElements=!1,r.__dirtyUvs=!1,r.__dirtyNormals=!1,r.__dirtyTangents=!1,r.__dirtyColors=!1}else if(e instanceof THREE.Ribbon){if(r=e.geometry,r.__dirtyVertices||r.__dirtyColors){if(e=r,i=w.DYNAMIC_DRAW,m=e.vertices,n=e.colors,g=m.length,a=n.length,T=e.__vertexArray,s=e.__colorArray,v=e.__dirtyColors,e.__dirtyVertices){for(h=0;h<g;h++)p=m[h].position,o=3*h,T[o]=p.x,T[o+1]=p.y,T[o+2]=p.z;w.bindBuffer(w.ARRAY_BUFFER,e.__webglVertexBuffer),w.bufferData(w.ARRAY_BUFFER,T,i)}if(v){for(h=0;h<a;h++)color=n[h],o=3*h,s[o]=color.r,s[o+1]=color.g,s[o+2]=color.b;w.bindBuffer(w.ARRAY_BUFFER,e.__webglColorBuffer),w.bufferData(w.ARRAY_BUFFER,s,i)}}r.__dirtyVertices=!1,r.__dirtyColors=!1}else if(e instanceof THREE.Line){if(r=e.geometry,r.__dirtyVertices||r.__dirtyColors){if(e=r,i=w.DYNAMIC_DRAW,m=e.vertices,n=e.colors,g=m.length,a=n.length,T=e.__vertexArray,s=e.__colorArray,v=e.__dirtyColors,e.__dirtyVertices){for(h=0;h<g;h++)p=m[h].position,o=3*h,T[o]=p.x,T[o+1]=p.y,T[o+2]=p.z;w.bindBuffer(w.ARRAY_BUFFER,e.__webglVertexBuffer),w.bufferData(w.ARRAY_BUFFER,T,i)}if(v){for(h=0;h<a;h++)color=n[h],o=3*h,s[o]=color.r,s[o+1]=color.g,s[o+2]=color.b;w.bindBuffer(w.ARRAY_BUFFER,e.__webglColorBuffer),w.bufferData(w.ARRAY_BUFFER,s,i)}}r.__dirtyVertices=!1,r.__dirtyColors=!1}else e instanceof THREE.ParticleSystem&&(r=e.geometry,(r.__dirtyVertices||r.__dirtyColors||e.sortParticles)&&t(r,w.DYNAMIC_DRAW,e),r.__dirtyVertices=!1,r.__dirtyColors=!1)}function R(e){function t(e){var t=[];for(i=0,r=e.length;i<r;i++)null==e[i]?t.push("undefined"):t.push(e[i].id);return t.join("_")}var i,r,n,o,a,s,h,l,c={},f=void 0!==e.morphTargets?e.morphTargets.length:0;for(e.geometryGroups={},n=0,o=e.faces.length;n<o;n++)a=e.faces[n],s=a.materials,h=t(s),null==c[h]&&(c[h]={hash:h,counter:0}),l=c[h].hash+"_"+c[h].counter,null==e.geometryGroups[l]&&(e.geometryGroups[l]={faces:[],materials:s,vertices:0,numMorphTargets:f}),a=a instanceof THREE.Face3?3:4,e.geometryGroups[l].vertices+a>65535&&(c[h].counter+=1,l=c[h].hash+"_"+c[h].counter,null==e.geometryGroups[l]&&(e.geometryGroups[l]={faces:[],materials:s,vertices:0,numMorphTargets:f})),e.geometryGroups[l].faces.push(n),e.geometryGroups[l].vertices+=a}function _(e,t,i){e.push({buffer:t,object:i,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function y(e){if(e!=z){switch(e){case THREE.AdditiveBlending:w.blendEquation(w.FUNC_ADD),w.blendFunc(w.SRC_ALPHA,w.ONE);break;case THREE.SubtractiveBlending:w.blendEquation(w.FUNC_ADD),w.blendFunc(w.ZERO,w.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:w.blendEquation(w.FUNC_ADD),w.blendFunc(w.ZERO,w.SRC_COLOR);break;default:w.blendEquationSeparate(w.FUNC_ADD,w.FUNC_ADD),w.blendFuncSeparate(w.SRC_ALPHA,w.ONE_MINUS_SRC_ALPHA,w.ONE,w.ONE_MINUS_SRC_ALPHA)}z=e}}function x(e,t,i){0==(i.width&i.width-1)&&0==(i.height&i.height-1)?(w.texParameteri(e,w.TEXTURE_WRAP_S,A(t.wrapS)),w.texParameteri(e,w.TEXTURE_WRAP_T,A(t.wrapT)),w.texParameteri(e,w.TEXTURE_MAG_FILTER,A(t.magFilter)),w.texParameteri(e,w.TEXTURE_MIN_FILTER,A(t.minFilter)),w.generateMipmap(e)):(w.texParameteri(e,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(e,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(e,w.TEXTURE_MAG_FILTER,M(t.magFilter)),w.texParameteri(e,w.TEXTURE_MIN_FILTER,M(t.minFilter)))}function b(e,t){e.needsUpdate&&(e.__webglInit?(w.bindTexture(w.TEXTURE_2D,e.__webglTexture),w.texSubImage2D(w.TEXTURE_2D,0,0,0,w.RGBA,w.UNSIGNED_BYTE,e.image)):(e.__webglTexture=w.createTexture(),w.bindTexture(w.TEXTURE_2D,e.__webglTexture),w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,e.image),e.__webglInit=!0),x(w.TEXTURE_2D,e,e.image),w.bindTexture(w.TEXTURE_2D,null),e.needsUpdate=!1),w.activeTexture(w.TEXTURE0+t),w.bindTexture(w.TEXTURE_2D,e.__webglTexture)}function H(e){var t,i;e&&!e.__webglFramebuffer&&(void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.__webglFramebuffer=w.createFramebuffer(),e.__webglRenderbuffer=w.createRenderbuffer(),e.__webglTexture=w.createTexture(),w.bindTexture(w.TEXTURE_2D,e.__webglTexture),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,A(e.wrapS)),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,A(e.wrapT)),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,A(e.magFilter)),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,A(e.minFilter)),w.texImage2D(w.TEXTURE_2D,0,A(e.format),e.width,e.height,0,A(e.format),A(e.type),null),w.bindRenderbuffer(w.RENDERBUFFER,e.__webglRenderbuffer),w.bindFramebuffer(w.FRAMEBUFFER,e.__webglFramebuffer),w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_2D,e.__webglTexture,0),e.depthBuffer&&!e.stencilBuffer?(w.renderbufferStorage(w.RENDERBUFFER,w.DEPTH_COMPONENT16,e.width,e.height),w.framebufferRenderbuffer(w.FRAMEBUFFER,w.DEPTH_ATTACHMENT,w.RENDERBUFFER,e.__webglRenderbuffer)):e.depthBuffer&&e.stencilBuffer?(w.renderbufferStorage(w.RENDERBUFFER,w.DEPTH_STENCIL,e.width,e.height),w.framebufferRenderbuffer(w.FRAMEBUFFER,w.DEPTH_STENCIL_ATTACHMENT,w.RENDERBUFFER,e.__webglRenderbuffer)):w.renderbufferStorage(w.RENDERBUFFER,w.RGBA4,e.width,e.height),w.bindTexture(w.TEXTURE_2D,null),w.bindRenderbuffer(w.RENDERBUFFER,null),w.bindFramebuffer(w.FRAMEBUFFER,null)),e?(t=e.__webglFramebuffer,i=e.width,e=e.height):(t=null,i=O,e=j),t!=B&&(w.bindFramebuffer(w.FRAMEBUFFER,t),w.viewport(I,k,i,e),B=t)}function S(e,t){var i;return"fragment"==e?i=w.createShader(w.FRAGMENT_SHADER):"vertex"==e&&(i=w.createShader(w.VERTEX_SHADER)),w.shaderSource(i,t),w.compileShader(i),w.getShaderParameter(i,w.COMPILE_STATUS)?i:(console.error(w.getShaderInfoLog(i)),console.error(t),null)}function M(e){switch(e){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return w.NEAREST;default:return w.LINEAR}}function A(e){switch(e){case THREE.RepeatWrapping:return w.REPEAT;case THREE.ClampToEdgeWrapping:return w.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return w.MIRRORED_REPEAT;case THREE.NearestFilter:return w.NEAREST;case THREE.NearestMipMapNearestFilter:return w.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return w.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return w.LINEAR;case THREE.LinearMipMapNearestFilter:return w.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return w.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return w.BYTE;case THREE.UnsignedByteType:return w.UNSIGNED_BYTE;case THREE.ShortType:return w.SHORT;case THREE.UnsignedShortType:return w.UNSIGNED_SHORT;case THREE.IntType:return w.INT;case THREE.UnsignedShortType:return w.UNSIGNED_INT;case THREE.FloatType:return w.FLOAT;case THREE.AlphaFormat:return w.ALPHA;case THREE.RGBFormat:return w.RGB;case THREE.RGBAFormat:return w.RGBA;case THREE.LuminanceFormat:return w.LUMINANCE;case THREE.LuminanceAlphaFormat:return w.LUMINANCE_ALPHA}return 0}var w,F=document.createElement("canvas"),L=[],C=null,B=null,U=!0,D=this,P=null,V=null,z=null,N=null,I=0,k=0,O=0,j=0,W=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],G=new THREE.Matrix4,X=new Float32Array(16),Y=new Float32Array(16),q=new THREE.Vector4,K={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}};if(e=e||{},stencil=void 0===e.stencil||e.stencil,antialias=void 0!==e.antialias&&e.antialias,clearColor=void 0!==e.clearColor?new THREE.Color(e.clearColor):new THREE.Color(0),clearAlpha=void 0!==e.clearAlpha?e.clearAlpha:0,this.maxMorphTargets=8,this.domElement=F,this.autoClear=!0,this.sortObjects=!0,function(e,t,i,r){try{if(!(w=F.getContext("experimental-webgl",{antialias:e,stencil:r})))throw"Error creating WebGL context."}catch(e){console.error(e)}console.log(navigator.userAgent+" | "+w.getParameter(w.VERSION)+" | "+w.getParameter(w.VENDOR)+" | "+w.getParameter(w.RENDERER)+" | "+w.getParameter(w.SHADING_LANGUAGE_VERSION)),w.clearColor(0,0,0,1),w.clearDepth(1),w.enable(w.DEPTH_TEST),w.depthFunc(w.LEQUAL),w.frontFace(w.CCW),w.cullFace(w.BACK),w.enable(w.CULL_FACE),w.enable(w.BLEND),w.blendEquation(w.FUNC_ADD),w.blendFunc(w.SRC_ALPHA,w.ONE_MINUS_SRC_ALPHA),w.clearColor(t.r,t.g,t.b,i)}(antialias,clearColor,clearAlpha,stencil),this.context=w,stencil){var Q={};Q.vertices=new Float32Array(12),Q.faces=new Uint16Array(6),Q.darkness=.5,Q.vertices[0]=-20,Q.vertices[1]=-20,Q.vertices[2]=-1,Q.vertices[3]=20,Q.vertices[4]=-20,Q.vertices[5]=-1,Q.vertices[6]=20,Q.vertices[7]=20,Q.vertices[8]=-1,Q.vertices[9]=-20,Q.vertices[10]=20,Q.vertices[11]=-1,Q.faces[0]=0,Q.faces[1]=1,Q.faces[2]=2,Q.faces[3]=0,Q.faces[4]=2,Q.faces[5]=3,Q.vertexBuffer=w.createBuffer(),Q.elementBuffer=w.createBuffer(),w.bindBuffer(w.ARRAY_BUFFER,Q.vertexBuffer),w.bufferData(w.ARRAY_BUFFER,Q.vertices,w.STATIC_DRAW),w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,Q.elementBuffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,Q.faces,w.STATIC_DRAW),Q.program=w.createProgram(),w.attachShader(Q.program,S("fragment",THREE.ShaderLib.shadowPost.fragmentShader)),w.attachShader(Q.program,S("vertex",THREE.ShaderLib.shadowPost.vertexShader)),w.linkProgram(Q.program),Q.vertexLocation=w.getAttribLocation(Q.program,"position"),Q.projectionLocation=w.getUniformLocation(Q.program,"projectionMatrix"),Q.darknessLocation=w.getUniformLocation(Q.program,"darkness")}var Z={};Z.vertices=new Float32Array(16),Z.faces=new Uint16Array(6),e=0,Z.vertices[e++]=-1,Z.vertices[e++]=-1,Z.vertices[e++]=0,Z.vertices[e++]=0,Z.vertices[e++]=1,Z.vertices[e++]=-1,Z.vertices[e++]=1,Z.vertices[e++]=0,Z.vertices[e++]=1,Z.vertices[e++]=1,Z.vertices[e++]=1,Z.vertices[e++]=1,Z.vertices[e++]=-1,Z.vertices[e++]=1,Z.vertices[e++]=0,Z.vertices[e++]=1,e=0,Z.faces[e++]=0,Z.faces[e++]=1,Z.faces[e++]=2,Z.faces[e++]=0,Z.faces[e++]=2,Z.faces[e++]=3,Z.vertexBuffer=w.createBuffer(),Z.elementBuffer=w.createBuffer(),Z.tempTexture=w.createTexture(),Z.occlusionTexture=w.createTexture(),w.bindBuffer(w.ARRAY_BUFFER,Z.vertexBuffer),w.bufferData(w.ARRAY_BUFFER,Z.vertices,w.STATIC_DRAW),w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,Z.elementBuffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,Z.faces,w.STATIC_DRAW),w.bindTexture(w.TEXTURE_2D,Z.tempTexture),w.texImage2D(w.TEXTURE_2D,0,w.RGB,16,16,0,w.RGB,w.UNSIGNED_BYTE,null),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.NEAREST),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.NEAREST),w.bindTexture(w.TEXTURE_2D,Z.occlusionTexture),w.texImage2D(w.TEXTURE_2D,0,w.RGBA,16,16,0,w.RGBA,w.UNSIGNED_BYTE,null),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.NEAREST),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.NEAREST),w.getParameter(w.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(Z.hasVertexTexture=!1,Z.program=w.createProgram(),w.attachShader(Z.program,S("fragment",THREE.ShaderLib.lensFlare.fragmentShader)),w.attachShader(Z.program,S("vertex",THREE.ShaderLib.lensFlare.vertexShader))):(Z.hasVertexTexture=!0,Z.program=w.createProgram(),w.attachShader(Z.program,S("fragment",THREE.ShaderLib.lensFlareVertexTexture.fragmentShader)),w.attachShader(Z.program,S("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader))),w.linkProgram(Z.program),Z.attributes={},Z.uniforms={},Z.attributes.vertex=w.getAttribLocation(Z.program,"position"),Z.attributes.uv=w.getAttribLocation(Z.program,"UV"),Z.uniforms.renderType=w.getUniformLocation(Z.program,"renderType"),Z.uniforms.map=w.getUniformLocation(Z.program,"map"),Z.uniforms.occlusionMap=w.getUniformLocation(Z.program,"occlusionMap"),Z.uniforms.opacity=w.getUniformLocation(Z.program,"opacity"),Z.uniforms.scale=w.getUniformLocation(Z.program,"scale"),Z.uniforms.rotation=w.getUniformLocation(Z.program,"rotation"),Z.uniforms.screenPosition=w.getUniformLocation(Z.program,"screenPosition");var J=!1;_sprite={},_sprite.vertices=new Float32Array(16),_sprite.faces=new Uint16Array(6),e=0,_sprite.vertices[e++]=-1,_sprite.vertices[e++]=-1,_sprite.vertices[e++]=0,_sprite.vertices[e++]=0,_sprite.vertices[e++]=1,_sprite.vertices[e++]=-1,_sprite.vertices[e++]=1,_sprite.vertices[e++]=0,_sprite.vertices[e++]=1,_sprite.vertices[e++]=1,_sprite.vertices[e++]=1,_sprite.vertices[e++]=1,_sprite.vertices[e++]=-1,_sprite.vertices[e++]=1,_sprite.vertices[e++]=0,_sprite.vertices[e++]=1,e=0,_sprite.faces[e++]=0,_sprite.faces[e++]=1,_sprite.faces[e++]=2,_sprite.faces[e++]=0,_sprite.faces[e++]=2,_sprite.faces[e++]=3,_sprite.vertexBuffer=w.createBuffer(),_sprite.elementBuffer=w.createBuffer(),w.bindBuffer(w.ARRAY_BUFFER,_sprite.vertexBuffer),w.bufferData(w.ARRAY_BUFFER,_sprite.vertices,w.STATIC_DRAW),w.bindBuffer(w.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,_sprite.faces,w.STATIC_DRAW),_sprite.program=w.createProgram(),w.attachShader(_sprite.program,S("fragment",THREE.ShaderLib.sprite.fragmentShader)),w.attachShader(_sprite.program,S("vertex",THREE.ShaderLib.sprite.vertexShader)),w.linkProgram(_sprite.program),_sprite.attributes={},_sprite.uniforms={},_sprite.attributes.position=w.getAttribLocation(_sprite.program,"position"),_sprite.attributes.uv=w.getAttribLocation(_sprite.program,"uv"),_sprite.uniforms.uvOffset=w.getUniformLocation(_sprite.program,"uvOffset"),_sprite.uniforms.uvScale=w.getUniformLocation(_sprite.program,"uvScale"),_sprite.uniforms.rotation=w.getUniformLocation(_sprite.program,"rotation"),_sprite.uniforms.scale=w.getUniformLocation(_sprite.program,"scale"),_sprite.uniforms.alignment=w.getUniformLocation(_sprite.program,"alignment"),_sprite.uniforms.map=w.getUniformLocation(_sprite.program,"map"),_sprite.uniforms.opacity=w.getUniformLocation(_sprite.program,"opacity"),_sprite.uniforms.useScreenCoordinates=w.getUniformLocation(_sprite.program,"useScreenCoordinates"),_sprite.uniforms.affectedByDistance=w.getUniformLocation(_sprite.program,"affectedByDistance"),_sprite.uniforms.screenPosition=w.getUniformLocation(_sprite.program,"screenPosition"),_sprite.uniforms.modelViewMatrix=w.getUniformLocation(_sprite.program,"modelViewMatrix"),_sprite.uniforms.projectionMatrix=w.getUniformLocation(_sprite.program,"projectionMatrix");var $=!1;this.setSize=function(e,t){F.width=e,F.height=t,this.setViewport(0,0,F.width,F.height)},this.setViewport=function(e,t,i,r){I=e,k=t,O=i,j=r,w.viewport(I,k,O,j)},this.setScissor=function(e,t,i,r){w.scissor(e,t,i,r)},this.enableScissorTest=function(e){e?w.enable(w.SCISSOR_TEST):w.disable(w.SCISSOR_TEST)},this.enableDepthBufferWrite=function(e){U=e,w.depthMask(e)},this.setClearColorHex=function(e,t){var i=new THREE.Color(e);w.clearColor(i.r,i.g,i.b,t)},this.setClearColor=function(e,t){w.clearColor(e.r,e.g,e.b,t)},this.clear=function(){w.clear(w.COLOR_BUFFER_BIT|w.DEPTH_BUFFER_BIT|w.STENCIL_BUFFER_BIT)},this.setStencilShadowDarkness=function(e){Q.darkness=e},this.initMaterial=function(e,t,i,r){var n,o,a,s,h,l,c;if(e instanceof THREE.MeshDepthMaterial?a="depth":e instanceof THREE.ShadowVolumeDynamicMaterial?a="shadowVolumeDynamic":e instanceof THREE.MeshNormalMaterial?a="normal":e instanceof THREE.MeshBasicMaterial?a="basic":e instanceof THREE.MeshLambertMaterial?a="lambert":e instanceof THREE.MeshPhongMaterial?a="phong":e instanceof THREE.LineBasicMaterial?a="basic":e instanceof THREE.ParticleBasicMaterial&&(a="particle_basic"),a){var f=THREE.ShaderLib[a];e.uniforms=THREE.UniformsUtils.clone(f.uniforms),e.vertexShader=f.vertexShader,e.fragmentShader=f.fragmentShader}for(s=l=f=0,h=t.length;s<h;s++)o=t[s],o instanceof THREE.DirectionalLight&&l++,o instanceof THREE.PointLight&&f++;f+l<=4?t=l:(t=Math.ceil(4*l/(f+l)),f=4-t),o={directional:t,point:f},l=50,void 0!==r&&r instanceof THREE.SkinnedMesh&&(l=r.bones.length);e:{var E,u;for(E in s=e.fragmentShader,h=e.vertexShader,f=e.uniforms,t=e.attributes,i={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,vertexColors:e.vertexColors,fog:i,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,morphTargets:e.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:o.directional,maxPointLights:o.point,maxBones:l},o=[],a?o.push(a):(o.push(s),o.push(h)),i)o.push(E),o.push(i[E]);for(a=o.join(),E=0,o=L.length;E<o;E++)if(L[E].code==a){c=L[E].program;break e}for(u in E=w.createProgram(),prefix_fragment=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,i.fog?"#define USE_FOG":"",i.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),prefix_vertex=[w.getParameter(w.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.vertexColors?"#define USE_COLOR":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),w.attachShader(E,S("fragment",prefix_fragment+s)),w.attachShader(E,S("vertex",prefix_vertex+h)),w.linkProgram(E),w.getProgramParameter(E,w.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+w.getProgramParameter(E,w.VALIDATE_STATUS)+", gl error ["+w.getError()+"]"),E.uniforms={},E.attributes={},s=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"],f)s.push(u);for(u=s,f=0,s=u.length;f<s;f++)h=u[f],E.uniforms[h]=w.getUniformLocation(E,h);for(s=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"],u=0;u<i.maxMorphTargets;u++)s.push("morphTarget"+u);for(c in t)s.push(c);for(c=s,u=0,t=c.length;u<t;u++)i=c[u],E.attributes[i]=w.getAttribLocation(E,i);L.push({program:E,code:a}),c=E}for(n in e.program=c,c=e.program.attributes,w.enableVertexAttribArray(c.position),c.color>=0&&w.enableVertexAttribArray(c.color),c.normal>=0&&w.enableVertexAttribArray(c.normal),c.tangent>=0&&w.enableVertexAttribArray(c.tangent),e.skinning&&c.skinVertexA>=0&&c.skinVertexB>=0&&c.skinIndex>=0&&c.skinWeight>=0&&(w.enableVertexAttribArray(c.skinVertexA),w.enableVertexAttribArray(c.skinVertexB),w.enableVertexAttribArray(c.skinIndex),w.enableVertexAttribArray(c.skinWeight)),e.attributes)c[n]>=0&&w.enableVertexAttribArray(c[n]);if(e.morphTargets)for(e.numSupportedMorphTargets=0,
c.morphTarget0>=0&&(w.enableVertexAttribArray(c.morphTarget0),e.numSupportedMorphTargets++),c.morphTarget1>=0&&(w.enableVertexAttribArray(c.morphTarget1),e.numSupportedMorphTargets++),c.morphTarget2>=0&&(w.enableVertexAttribArray(c.morphTarget2),e.numSupportedMorphTargets++),c.morphTarget3>=0&&(w.enableVertexAttribArray(c.morphTarget3),e.numSupportedMorphTargets++),c.morphTarget4>=0&&(w.enableVertexAttribArray(c.morphTarget4),e.numSupportedMorphTargets++),c.morphTarget5>=0&&(w.enableVertexAttribArray(c.morphTarget5),e.numSupportedMorphTargets++),c.morphTarget6>=0&&(w.enableVertexAttribArray(c.morphTarget6),e.numSupportedMorphTargets++),c.morphTarget7>=0&&(w.enableVertexAttribArray(c.morphTarget7),e.numSupportedMorphTargets++),r.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets),e=0,n=this.maxMorphTargets;e<n;e++)r.__webglMorphTargetInfluences[e]=0},this.render=function(e,t,a,l){var f,v,R,_,x,b,S,M,A=e.lights,F=e.fog;for(t.matrixAutoUpdate&&t.updateMatrix(),e.update(void 0,!1,t),t.matrixWorldInverse.flattenToArray(Y),t.projectionMatrix.flattenToArray(X),G.multiply(t.projectionMatrix,t.matrixWorldInverse),h(G),this.initWebGLObjects(e),H(a),(this.autoClear||l)&&this.clear(),x=e.__webglObjects.length,l=0;l<x;l++)f=e.__webglObjects[l],S=f.object,S.visible?S instanceof THREE.Mesh&&!c(S)?f.render=!1:(S.matrixWorld.flattenToArray(S._objectMatrixArray),T(S,t),u(f),f.render=!0,this.sortObjects&&(q.copy(S.position),G.multiplyVector3(q),f.z=q.z)):f.render=!1;for(this.sortObjects&&e.__webglObjects.sort(d),b=e.__webglObjectsImmediate.length,l=0;l<b;l++)f=e.__webglObjectsImmediate[l],S=f.object,S.visible&&(S.matrixAutoUpdate&&S.matrixWorld.flattenToArray(S._objectMatrixArray),T(S,t),E(f));for(y(THREE.NormalBlending),l=0;l<x;l++)if(f=e.__webglObjects[l],f.render)for(S=f.object,M=f.buffer,R=f.opaque,o(S),f=0;f<R.count;f++)_=R.list[f],s(_.depthTest),r(t,A,F,_,M,S);for(l=0;l<b;l++)if(f=e.__webglObjectsImmediate[l],S=f.object,S.visible)for(R=f.opaque,o(S),f=0;f<R.count;f++)_=R.list[f],s(_.depthTest),v=i(t,A,F,_,S),S.render(function(e){n(e,v,_.shading)});for(l=0;l<x;l++)if(f=e.__webglObjects[l],f.render)for(S=f.object,M=f.buffer,R=f.transparent,o(S),f=0;f<R.count;f++)_=R.list[f],y(_.blending),s(_.depthTest),r(t,A,F,_,M,S);for(l=0;l<b;l++)if(f=e.__webglObjectsImmediate[l],S=f.object,S.visible)for(R=f.transparent,o(S),f=0;f<R.count;f++)_=R.list[f],y(_.blending),s(_.depthTest),v=i(t,A,F,_,S),S.render(function(e){n(e,v,_.shading)});e.__webglSprites.length&&m(e,t),stencil&&e.__webglShadowVolumes.length&&e.lights.length&&p(e),e.__webglLensFlares.length&&g(e,t),a&&a.minFilter!==THREE.NearestFilter&&a.minFilter!==THREE.LinearFilter&&(w.bindTexture(w.TEXTURE_2D,a.__webglTexture),w.generateMipmap(w.TEXTURE_2D),w.bindTexture(w.TEXTURE_2D,null))},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglShadowVolumes=[],e.__webglLensFlares=[],e.__webglSprites=[]);e.__objectsAdded.length;){var t=e.__objectsAdded[0],i=e,r=void 0,n=void 0,o=void 0;if(null==t._modelViewMatrix&&(t._modelViewMatrix=new THREE.Matrix4,t._normalMatrixArray=new Float32Array(9),t._modelViewMatrixArray=new Float32Array(16),t._objectMatrixArray=new Float32Array(16),t.matrixWorld.flattenToArray(t._objectMatrixArray)),t instanceof THREE.Mesh)for(r in n=t.geometry,null==n.geometryGroups&&R(n),n.geometryGroups){if(o=n.geometryGroups[r],!o.__webglVertexBuffer){var s=o;if(s.__webglVertexBuffer=w.createBuffer(),s.__webglNormalBuffer=w.createBuffer(),s.__webglTangentBuffer=w.createBuffer(),s.__webglColorBuffer=w.createBuffer(),s.__webglUVBuffer=w.createBuffer(),s.__webglUV2Buffer=w.createBuffer(),s.__webglSkinVertexABuffer=w.createBuffer(),s.__webglSkinVertexBBuffer=w.createBuffer(),s.__webglSkinIndicesBuffer=w.createBuffer(),s.__webglSkinWeightsBuffer=w.createBuffer(),s.__webglFaceBuffer=w.createBuffer(),s.__webglLineBuffer=w.createBuffer(),s.numMorphTargets){var h=void 0,c=void 0;for(s.__webglMorphTargetsBuffers=[],h=0,c=s.numMorphTargets;h<c;h++)s.__webglMorphTargetsBuffers.push(w.createBuffer())}s=o,h=t;var f=void 0,E=void 0,u=void 0;u=void 0;var d=void 0,p=void 0,m=void 0,g=m=c=0;E=void 0,u=void 0;var T=void 0;for(f=void 0,E=void 0,d=h.geometry,T=d.faces,p=s.faces,f=0,E=p.length;f<E;f++)u=p[f],u=T[u],u instanceof THREE.Face3?(c+=3,m+=1,g+=3):u instanceof THREE.Face4&&(c+=4,m+=2,g+=4);f=s,E=h,T=void 0,p=void 0;var y=void 0,x=void 0;for(y=void 0,u=[],T=0,p=E.materials.length;T<p;T++)if(y=E.materials[T],y instanceof THREE.MeshFaceMaterial)for(y=0,l=f.materials.length;y<l;y++)(x=f.materials[y])&&u.push(x);else(x=y)&&u.push(x);f=u;e:{for(E=void 0,T=void 0,p=f.length,E=0;E<p;E++)if(T=f[E],T.map||T.lightMap||T instanceof THREE.MeshShaderMaterial){E=!0;break e}E=!1}e:{for(T=void 0,p=void 0,u=f.length,T=0;T<u;T++)if(p=f[T],!(p instanceof THREE.MeshBasicMaterial&&!p.envMap||p instanceof THREE.MeshDepthMaterial)){T=p&&null!=p.shading&&p.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break e}T=!1}e:{for(p=void 0,u=void 0,y=f.length,p=0;p<y;p++)if(u=f[p],u.vertexColors){u=u.vertexColors;break e}u=!1}if(s.__vertexArray=new Float32Array(3*c),T&&(s.__normalArray=new Float32Array(3*c)),d.hasTangents&&(s.__tangentArray=new Float32Array(4*c)),u&&(s.__colorArray=new Float32Array(3*c)),E&&((d.faceUvs.length>0||d.faceVertexUvs.length>0)&&(s.__uvArray=new Float32Array(2*c)),(d.faceUvs.length>1||d.faceVertexUvs.length>1)&&(s.__uv2Array=new Float32Array(2*c))),h.geometry.skinWeights.length&&h.geometry.skinIndices.length&&(s.__skinVertexAArray=new Float32Array(4*c),s.__skinVertexBArray=new Float32Array(4*c),s.__skinIndexArray=new Float32Array(4*c),s.__skinWeightArray=new Float32Array(4*c)),s.__faceArray=new Uint16Array(3*m+(h.geometry.edgeFaces?6*h.geometry.edgeFaces.length:0)),s.__lineArray=new Uint16Array(2*g),s.numMorphTargets)for(s.__morphTargetsArrays=[],d=0,p=s.numMorphTargets;d<p;d++)s.__morphTargetsArrays.push(new Float32Array(3*c));for(s.__needsSmoothNormals=T==THREE.SmoothShading,s.__uvType=E,s.__vertexColorType=u,s.__normalType=T,s.__webglFaceCount=3*m+(h.geometry.edgeFaces?6*h.geometry.edgeFaces.length:0),s.__webglLineCount=2*g,d=0,p=f.length;d<p;d++)if(f[d].attributes)for(a in s.__webglCustomAttributes={},f[d].attributes)E=f[d].attributes[a],m=1,"v2"===E.type?m=2:"v3"===E.type?m=3:"v4"===E.type?m=4:"c"===E.type&&(m=3),E.size=m,E.needsUpdate=!0,E.array=new Float32Array(c*m),E.buffer=w.createBuffer(),s.__webglCustomAttributes[a]=E;n.__dirtyVertices=!0,n.__dirtyMorphTargets=!0,n.__dirtyElements=!0,n.__dirtyUvs=!0,n.__dirtyNormals=!0,n.__dirtyTangents=!0,n.__dirtyColors=!0}t instanceof THREE.ShadowVolume?_(i.__webglShadowVolumes,o,t):_(i.__webglObjects,o,t)}else t instanceof THREE.LensFlare?_(i.__webglLensFlares,void 0,t):t instanceof THREE.Ribbon?(n=t.geometry,n.__webglVertexBuffer||(r=n,r.__webglVertexBuffer=w.createBuffer(),r.__webglColorBuffer=w.createBuffer(),r=n,o=r.vertices.length,r.__vertexArray=new Float32Array(3*o),r.__colorArray=new Float32Array(3*o),r.__webglVertexCount=o,n.__dirtyVertices=!0,n.__dirtyColors=!0),_(i.__webglObjects,n,t)):t instanceof THREE.Line?(n=t.geometry,n.__webglVertexBuffer||(r=n,r.__webglVertexBuffer=w.createBuffer(),r.__webglColorBuffer=w.createBuffer(),r=n,o=r.vertices.length,r.__vertexArray=new Float32Array(3*o),r.__colorArray=new Float32Array(3*o),r.__webglLineCount=o,n.__dirtyVertices=!0,n.__dirtyColors=!0),_(i.__webglObjects,n,t)):t instanceof THREE.ParticleSystem?(n=t.geometry,n.__webglVertexBuffer||(r=n,r.__webglVertexBuffer=w.createBuffer(),r.__webglColorBuffer=w.createBuffer(),r=n,o=r.vertices.length,r.__vertexArray=new Float32Array(3*o),r.__colorArray=new Float32Array(3*o),r.__sortArray=[],r.__webglParticleCount=o,n.__dirtyVertices=!0,n.__dirtyColors=!0),_(i.__webglObjects,n,t)):void 0!==THREE.MarchingCubes&&t instanceof THREE.MarchingCubes?i.__webglObjectsImmediate.push({object:t,opaque:{list:[],count:0},transparent:{list:[],count:0}}):t instanceof THREE.Sprite&&i.__webglSprites.push(t);e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){for(t=e.__objectsRemoved[0],i=e,n=void 0,r=void 0,n=i.__webglObjects.length-1;n>=0;n--)if(r=i.__webglObjects[n].object,t==r){i.__webglObjects.splice(n,1);break}e.__objectsRemoved.splice(0,1)}for(t=0,i=e.__webglObjects.length;t<i;t++)v(e.__webglObjects[t].object,e);for(t=0,i=e.__webglShadowVolumes.length;t<i;t++)v(e.__webglShadowVolumes[t].object,e);for(t=0,i=e.__webglLensFlares.length;t<i;t++)v(e.__webglLensFlares[t].object,e)},this.setFaceCulling=function(e,t){e?(t&&"ccw"!=t?w.frontFace(w.CW):w.frontFace(w.CCW),"back"==e?w.cullFace(w.BACK):"front"==e?w.cullFace(w.FRONT):w.cullFace(w.FRONT_AND_BACK),w.enable(w.CULL_FACE)):w.disable(w.CULL_FACE)},this.supportsVertexTextures=function(){return w.getParameter(w.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},THREE.WebGLRenderTarget=function(e,t,i){this.width=e,this.height=t,i=i||{},this.wrapS=void 0!==i.wrapS?i.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==i.wrapT?i.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==i.magFilter?i.magFilter:THREE.LinearFilter,this.minFilter=void 0!==i.minFilter?i.minFilter:THREE.LinearMipMapLinearFilter,this.format=void 0!==i.format?i.format:THREE.RGBAFormat,this.type=void 0!==i.type?i.type:THREE.UnsignedByteType,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer};